define("nowcoder/1.2.582/javascripts/kit/upload/fileInput",["../../lib/jquery","../../lib/underscore","../../core/base","./upload"],function(a,b,c){function d(a){return/\.(png|jpg|jpeg|bmp|gif)$/gi.test(a)}function e(a){var b=this;b.rawConfig=a||{},b.input=i(a.input),b.input.length>0&&l.support()&&b.initEvent()}function f(){var a=this,b=a.input.get(0),c=a.rawConfig;a.input.on("change",function(){var d=b.files,e=d[0];if(e){var f=e.type,g=e.size;if(c.check&&!c.check.call(a,e,f,g))return a.clear(),void 0;l.uploadFile(e,a.rawConfig),a.clear()}})}function g(a){var b=this;m.upload(a,b.rawConfig,b)}function h(){var a=this;a.input.val("")}var i=a("../../lib/jquery"),j=a("../../lib/underscore"),k=a("../../core/base"),l=a("./upload"),m=c.exports=k.createClass("kit.upload.FileInput");j.extend(m,{isImage:d}),j.extend(m.prototype,{initialize:e,initEvent:f,upload:g,clear:h})});

define("nowcoder/1.2.582/javascripts/kit/upload/paste",["../../lib/jquery","../../lib/underscore","../../core/base","./upload"],function(a,b,c){function d(a){return 0===a.type.indexOf("image")}function e(a){var b=this;b.rawConfig=a||{},j.support()&&b.initEvent()}function f(){var a=this,b=a.rawConfig;g(b.doc||document).on("paste",function(a){var c=g(b.input).get(0);if(!c||c===a.target||g.contains(c,a.target)){var d,e=a.originalEvent,f=e.clipboardData||{};if(h.forEach(f.items,function(a){"file"===a.kind&&(d=!b.check||b.check(a)?a:d)}),d){a.preventDefault();var i=d.getAsFile();j.uploadBlob(i,(new Date).getTime()+"."+i.type.split("/").pop(),b)}}})}var g=a("../../lib/jquery"),h=a("../../lib/underscore"),i=a("../../core/base"),j=a("./upload"),k=c.exports=i.createClass("kit.upload.Paste");h.extend(k,{isImage:d}),h.extend(k.prototype,{initialize:e,initEvent:f})});

define("nowcoder/1.2.582/javascripts/kit/upload/upload",["../../lib/underscore"],function(a,b,c){function d(){return!!(j&&window.XMLHttpRequest&&window.JSON&&window.addEventListener)}function e(a,b){var c=this,d=new j;d.append(b.name||"file",a),c.uploadFormData(d,b)}function f(a,b,c){var d=this,e=new j;e.append(c.name||"file",a,b),d.uploadFormData(e,c)}function g(a,b){var c=this,d=b.XMLHttpRequest||window.XMLHttpRequest;i.forEach(b.data,function(b,c){c&&b&&a.append(c,b)});var e=new d;e.upload.addEventListener("progress",function(a){b.progress&&b.progress.call(null,Math.round(100*a.loaded/(a.total||1)),a.loaded,a.total)},!1),e.onreadystatechange=function(){if(4===e.readyState)if(200==e.status){var a=c.parseJSON(e.responseText),d=b[0===a.code?"call":"error"];d&&d.call(null,a)}else b.error&&b.error.call(c,{msg:"出现错误，请重试"})},e.open("POST",b.url,!0),e.send(a)}function h(a){var b={};try{b=JSON.parse(a)}catch(c){}return b}var i=a("../../lib/underscore"),j=window.FormData;c.exports={support:d,uploadFile:e,uploadBlob:f,uploadFormData:g,parseJSON:h}});

define("nowcoder/1.2.582/javascripts/component/editorSub/hEditor",["../../lib/kindeditor","../../lib/jquery","../../lib/underscore","../../core/base","../../util/dom","../../util/browser","../../util/util","../../util/cookie","../../util/uploadRemote","../../core/siteConfig","../menu","../../core/component","../../util/event","../select","../popup","../layer","../../util/dragdrop"],function(a,b,c){function d(a,b){if(a=R(a),0!==a.length){var c=(a.prop("tagName")||"").toLowerCase(),d="input"===c||"textarea"===c;return new bb(S.extend({renderTo:a,renderBy:"replaceWith",content:d?a.val():"",height:Math.max(a.outerHeight(),200)},b))}}function e(a){var b=this;b._addKEPlugin(),b._createdQueue=[],bb.superClass.initialize.call(b,a)}function f(){var a=this,b=a.rawConfig,c=a.getEl();a.lockInit("_initEvent")||(a.listen("afterCreate",function(){a.lockInit("_afterCreate")||(b.content&&a.val(b.content),S.forEach(a._createdQueue,function(b){b&&b.call(a)}),a._createdQueue.length=0,c.on("click","div.js-editor-mask",function(){try{b.clickMask&&b.clickMask.call(a)}catch(c){}}),b.afterCreate&&b.afterCreate.call(a))}),a.listen("afterChange",function(){var c=a.keEditor,d=c.edit.cmd.range,e=a.isInTagNode(d.startContainer,"blockquote")||a.isInTagNode(d.endContainer,"blockquote");e?c.toolbar.select("bockquote"):c.toolbar.unselect("bockquote");var f=a.isInTagNode(d.startContainer,"pre")||a.isInTagNode(d.endContainer,"pre");c.edit.designMode&&(f?(c.toolbar.disableAll(!0,["source","codeblock"]),c.toolbar.select("codeblock")):(c.toolbar.disableAll(!1),c.toolbar.unselect("codeblock"))),a.logContentChange(),b.afterChange&&b.afterChange.call(a)}),a.listen("afterBlur",function(){b.afterBlur&&b.afterBlur.call(a)}),a.listen("afterFocus",function(){b.afterFocus&&b.afterFocus.call(a)}))}function g(){var a=this,b=a.getEl(),c=R("<div></div>");b.append(c);var d=a.keEditor=Q.create(c.get(0),a.getEditorConf()),e=d.html;d.html=function(a){return a?(a=a.replace(/\u00A0/g,"&nbsp;"),e.call(this,a)):e.apply(this,arguments)}}function h(){var a=this,b=a.rawConfig;b.fullScreen&&a.waitCreated(function(){var c=R('<a href="javaScript:void(0);" class="full-ico"></a>');a.getToolbarEl().append(c),c.on("click",b.fullScreen)})}function i(){var a=this;if(!a.lockInit("_initPlaceHolder")){var b=a.rawConfig;a.waitCreated(function(){var c,d=R(a.getEditorDoc()),e=d.get(0).body;d.on("mousedown",c=function(){a._placeholderStatus&&(a.removePlaceHolder(),a._placeholderStatus=!0),d.unbind("mousedown",c)}),b.placeholder&&a.isEmpty()&&(e.innerHTML='<div id="kePlaceholder" style="color:#ddd;">'+b.placeholder+"</div>",a._placeholderStatus=!0),a.listen("afterBlur",function(){b.placeholder&&""===a.val()&&(e.innerHTML='<div id="kePlaceholder" style="color:#ddd;">'+b.placeholder+"</div>",a._placeholderStatus=!0)}),a.listen("afterFocus",function(){a.removePlaceHolder(),a._placeholderTimer||(a._placeholderTimer=window.setTimeout(function(){a.removePlaceHolder(),a._placeholderTimer=null},0))})})}}function j(){var a=this;X.ie()||a.lockInit("_initAutoLink")||a.waitCreated(function(){var b=a.getEditorDoc(),c=a.keEditor;R(b).on("keydown",function(a){var b=a.keyCode;if(32===b||13===b){var d=c.cmd.range,e=c.cmd.sel;if(d.collapsed){var f=d.endContainer,g=d.endOffset;if(3===f.nodeType){var h=f.nodeValue||"",i=h.substring(0,g),j=/(((http|https|ftp):\/\/)|(www\.))[a-zA-Z0-9-\.]+\.[a-zA-Z]+[a-zA-Z0-9-\/\.:\?=&]*$/gi,k=i.match(j);if(k){var l=k.pop(),m=i.lastIndexOf(l);try{d.setStart(f,m),e.removeAllRanges(),e.addRange(d.get(!0));var n=l;n.indexOf("://")<0&&(n="http://"+n),c.insertHtml('<a href="'+n+'" target="_blank">'+l+"</a>"),d.select(f)}catch(o){}}}}}})})}function k(){var a=this;a.lockInit("_initToolbarTips")||a.waitCreated(function(){try{var b=a.getToolbarEl().find("span.ke-outline");Z.titleTips({attachTo:b,verReverse:!0})}catch(c){}})}function l(){function a(a,c,h){b._scrollWindowTimer=window.setTimeout(function(){b._scrollWindowTimer=null;var a=c.outerHeight(),i=f.scrollTop(),j=c.offset();j.top<i+g&&j.top+a>i+g+e?(d||(d=h.width()||0),h.css("width",d),c.addClass("fixed-eidt-header"),h.css("top",g)):(c.removeClass("fixed-eidt-header"),h.css("top",null),h.css("width","auto"))},10)}var b=this,c=b.rawConfig;if(!c.noToolbarFixed&&!b.lockInit("_initToolbarFixed")){var d,e,f=R(window),g=+c.toolbarFixedTop||0;b.waitCreated(function(){var c=b.getEditorEl(),d=b.getToolbarEl();e=d.outerHeight(),b._scrollWindowTimer&&window.clearTimeout(b._scrollWindowTimer),b._toolbarScrollCb=function(){a(b.keEditor,c,d)},f.on("scroll",b._toolbarScrollCb),b._toolbarScrollCb()})}}function m(){var a=this,b=a.rawConfig;b.needChangeEditor&&a.waitCreated(function(){a.getToolbarEl().prepend('<a class="ico-to-html js-2-md">使用MD编辑器</a>')})}function n(){var a=this,b=a.rawConfig;b.noAutoHeight||a.lockInit("_initAutoHeight")||a.waitCreated(function(){var b=a.getEditorEl(),c=U.getScrollParent(b);c=c?R(c):R(window);var d=a.val();a.listen("afterChange",function(){var b=a.val();if(d!==b){d=b;try{a.autoHeight(c)}catch(e){}}})})}function o(){function a(a){var c=b.getToolbarEl(),d=new $({renderTo:c,renderBy:"prepend",size:"small",text:"代码语言",options:[{text:"ASP/VB",value:"vb"},{text:"C/C++",value:"cpp"},{text:"CSS",value:"css"},{text:"C#",value:"cs"},{text:"HTML",value:"html"},{text:"Java",value:"java"},{text:"JavaScript",value:"js"},{text:"Perl",value:"pl"},{text:"PHP",value:"php"},{text:"Python",value:"py"},{text:"Ruby",value:"rb"},{text:"Shell",value:"bsh"},{text:"XML",value:"xml"},{text:"其他",value:""}],change:function(){var c=this.val();b.removePlaceHolder(),a.select();var d=a.cmd.commonNode({pre:"*"});if(!d&&(a.exec("formatblock","<pre>"),d=a.cmd.commonNode({pre:"*"}))){try{a.cmd.range.selectNodeContents(d),a.cmd.removeformat()}catch(e){}d.addClass("prettyprint"),d.next()||d.after("<br />")}R(d).removeClass().addClass("prettyprint "+(c?"lang-"+c:"")),a.select(),b.fire("afterChange")}});return d}var b=this,c=b.rawConfig;c.noCodeSelect||b.lockInit("_initCodeSelect")||b.waitCreated(function(){var c=b.keEditor,d=a(c);b.listen("afterChange",function(){var a=this,b=c.edit.cmd.range,e=a.isInTagNode(b.startContainer,"pre")||a.isInTagNode(b.endContainer,"pre");if(e){var f=c.cmd.commonNode({pre:"*"});if(f){var g=f.attr("class")||"",h=/lang-(.*)/.exec(g),i=h?h[1]||"":"";d.val(i)}}else d.clear()})})}function p(){var a=this;a.lockInit("_initShowCodeName")||a.waitCreated(function(){var b,c=a.keEditor,d=a.getEditorDoc(),e=a.getEditorWin();R(d).on("click","pre",function(f){if(f.shiftKey){var g=R(f.target),h=g.attr("class")||"",i=/lang-(.*)/.exec(h),j=i?i[1]||"":"",k=Q(a.getEditorEditEl().get(0)).pos(),l=Q(g.get(0)).pos(),m=R(e).scrollTop()||R(d.body).scrollTop(),n=k.y+(l.y<m?0:l.y-m);b=c.menu=new Q.MenuClass({name:"codename",width:150,centerLineMode:!1,x:k.x+l.x,y:n,z:50}),R(b.div).css({"max-height":"200px","overflow-y":"auto"});var o=[{name:"ASP/VB",val:"vb"},{name:"C/C++",val:"cpp"},{name:"CSS",val:"css"},{name:"C#",val:"cs"},{name:"HTML",val:"html"},{name:"Java",val:"java"},{name:"JavaScript",val:"js"},{name:"Perl",val:"pl"},{name:"PHP",val:"php"},{name:"Python",val:"py"},{name:"Ruby",val:"rb"},{name:"Shell",val:"bsh"},{name:"XML",val:"xml"},{name:"Other",val:""}];S.each(o,function(a){b.addItem({title:'<span unselectable="on">'+a.name+"</span>",checked:j===a.val,click:function(){a.val?g.removeClass().addClass("prettyprint lang-"+a.val):g.removeClass().addClass("prettyprint"),c.hideMenu()}})})}})})}function q(){var b=this,c=b.rawConfig;c.noPasteUpload||b.waitCreated(function(){var c,d=b.getEditor(),e=b.getEditorDoc();a.async("../../kit/upload/paste",function(a){new a({doc:e,input:e.body,name:"file",url:"/uploadImage?type=1",call:function(a){c&&c.close(),d.exec("insertimage",a.url)},progress:function(a){c||(c=new _({noUnique:!0,content:'<div class="subject-upload-inner" style="margin:0"><div class="upload-progress-bar"><span class="progress-txt">正在上传：'+a+'%</span><div class="progressing" style="width:'+a+'%;"></div></div></div>',width:540,hasNoTitle:!0,hasNoMove:!0,hasNoMargin:!0,close:function(){c=null}})),c.getEl("div.subject-upload-inner").html('<div class="upload-progress-bar"><span class="progress-txt">正在上传：'+a+'%</span><div class="progressing" style="width:'+a+'%;"></div></div>')},error:function(){c?(c.getEl("div.subject-upload-inner").html('<a href="javascript:void(0);" class="btn btn-block btn-default"><span class="upload-rusult-ico"><span class="fui-cross"></span></span>上传失败</a>'),R(document).one("click",function(){c.close()})):_.alert("出现错误，请重试")}})})})}function r(){function a(){if(!e){var a=c.getEditorDoc(),d=R(a.body).find("img"),f=d.length;if(0!==f){var g=S.map(d,function(a){return R.trim(R(a).attr("src"))});if(V.canUpload(g)){var h=b();e=!0;var i=0;S.forEach(d,function(a){a=R(a);var b=R.trim(a.attr("src"));V.upload(b,function(c){c&&c!==b&&(a.attr("src",c),a.attr("data-ke-src",c)),i++,i>=f&&(e=!1,h.close())})})}}}}function b(){return new _({hasNoTitle:!0,hasNoFooter:!0,noUnique:!0,content:'<div style="font-size:14px;text-align:center;">图片上传中...</div>'})}var c=this,d=c.rawConfig;if(!d.noUploadRemote){var e=!1;c.waitCreated(function(){c.listen("draftChange",a),a()})}}function s(){var a=this,b=a.rawConfig;b.toolAction&&a.waitCreated(function(){var c=a.getEditor();S.forEach(b.toolAction,function(a,b){c._handlers[b]=[a]})})}function t(){var a=this;return a.keEditor.html.apply(a.keEditor,arguments)}function u(){var a=this;return a.keEditor.text.apply(a.keEditor,arguments)}function v(){var a=this;try{a.keEditor.blur()}catch(b){}}function w(){var a=this;try{a.keEditor.focus()}catch(b){}}function x(a){var b=this,c=b.getEl();b.waitCreated(function(){var b=c.find(".js-editor-mask");a===!1?b.hide():(0===b.length&&(b=R('<div class="js-editor-mask" style="background:#fff;opacity:0;filter:alpha(opacity=0);position:absolute;width:100%;height:100%;top:0;left:0;z-index:999;"></div>'),c.append(b)),b.show())})}function y(){var a=this;return a.keEditor.isEmpty()}function z(a,b){var c=this,d=c.rawConfig,e=c.getEl();c.waitCreated(function(){var f=c.keEditor;if(a){e.outerWidth(a);var g=e.width();c.getEditorEl().outerWidth(g),c.getToolbarEl().outerWidth(g-2)}if(b){var h=c.getToolbarEl(),i=h.outerHeight();b=Math.max(b-i-2,0),d.noAutoHeight||(f.edit._editHeight=b+"px"),d.noAutoHeight?f.edit.setHeight(b):c.autoHeight()}})}function A(a){var b=this,c=b.rawConfig,d=b.keEditor,e=b.getEditorDoc();if(!c.noAutoHeight){if(!a){var f=b.getEditorEl();a=U.getScrollParent(f),a=a?R(a):R(window)}var g=a.scrollTop();d.edit.setHeight(1);var h=e.body.scrollHeight;b.getEditorEditEl().css("overflow","hidden").height(1),h=Math.max(h,e.body.scrollHeight);var i=b._lastHeight?h-b._lastHeight:0;b._lastHeight=h;var j=parseInt(d.edit._editHeight||0,10)||0;h=Math.max(h,j),d.edit.setHeight(h),a.scrollTop(g+(h===j?0:i))}}function B(a){var b=this,c=b.keEditor;c&&c.isCreated?a&&a.call(b):b._createdQueue.push(a)}function C(){function b(a){var b=new a({renderTo:c.getEl(),renderBy:"after",isAdmin:e.isAdmin,content:a.html2md(f),needChangeEditor:!0,afterChangeEditor:e.afterChangeEditor,width:d.outerWidth(),height:e.height,draftChange:e.draftChange,disabled:e.disabled,clickMask:e.clickMask,noToolbarFixed:e.noToolbarFixed,toolbarFixedTop:e.toolbarFixedTop,noAutoHeight:e.noAutoHeight,render:function(){c.destroy()}});e.afterChangeEditor&&e.afterChangeEditor.call(c,b),c.fire("changeEditor",b),d.hide()}var c=this,d=c.getEl(),e=c.rawConfig,f=c.val();return c.isEmpty()?(a.async("./mdEditor",function(a){b(a)}),void 0):(a.async("./mdEditor",function(a){var c=_.confirm('切换到 MarkDown 编辑器可能会丢失部分内容格式，确认切换？<a class="link-green" href="javascript:void(0);">预览转换后的效果</a>',function(){b(a)});c&&c.getEl().find("a.link-green").on("click",function(){var b=a.html2md(f),c=a.md2html(b),d=window.open(),e=d.document;e.open("text/html","replace");var g=["html{margin:0;padding:0}","body{margin:0;padding:5px;}","body, td {font-size:14px;line-height:20px;}","body, p, div {word-wrap: break-word;}","p {margin:5px 0;}","table {border-collapse:collapse;}","img {border:0;}","noscript {display:none;}","table.ke-zeroborder td {border:1px dotted #AAA;}",'body{background-color:transparent;font-family:arial,STHeiti,"Microsoft YaHei";line-height:1.8}',"table{width:100%;}","p{line-height:1.8}","h1,h2,h3,h4,h5,h6{margin:10px 0}","img{max-width:100%}",'blockquote{position:relative;color: #999;font-weight:300;font-family:Avenir, "Helvetica Neue", "Microsoft Yahei", "Hiragino Sans GB", "Microsoft Sans Serif", "WenQuanYi Micro Hei", sans-serif;border-left:2px solid #1abc9c;padding: 10px 0 10px 10px;margin: .8em 0;}',"pre{font-size: 14px;position: relative;border-left: 2px solid #1abc9c;padding: 10px 0 10px 10px;margin: .8em 0;background: #fefefe;word-break:break-all;}","a{color:#25bb9b;text-decoration:none;}"].join("");e.write("<html><head><title>预览</title><style>"+g+"</style></head><body>"+c+"</body></html>"),e.close()})}),void 0)}function D(){var a=this;return a.keEditor}function E(){var a=this;return a.keEditor.edit.doc}function F(){var a=this;return a.keEditor.edit.win}function G(){var a=this;return R(a.keEditor.container[0])}function H(){var a=this;return R(a.keEditor.edit.div)}function I(){var a=this;return R(a.keEditor.toolbar.div.get(0))}function J(){for(var a=this,b=a.keEditor.cmd.range.startContainer;b&&1!==b.nodeType;)b=b.parentNode;return b}function K(){var a=this,b=a.rawConfig,c=S.clone(W.get());c.type=Y.uploadType.image,c.token=W.get("csrf_token");var d={allowNCFileUpload:!0,allowFileManager:!0,themeType:"nowcoder",uploadJson:"/uploadImage",extraFileUploadParams:c,resizeType:0,height:"300px",newlineTag:"div",cssData:['body{background-color:transparent;font-family:arial,STHeiti,"Microsoft YaHei";line-height:1.8}',"p{line-height:1.8}","h1,h2,h3,h4,h5,h6{margin:10px 0}","img{max-width:100%}",'blockquote{position:relative;color: #999;font-weight:300;font-family:Avenir, "Helvetica Neue", "Microsoft Yahei", "Hiragino Sans GB", "Microsoft Sans Serif", "WenQuanYi Micro Hei", sans-serif;border-left:2px solid #1abc9c;padding: 10px 0 10px 10px;margin: .8em 0;}',"pre{font-size: 14px;position: relative;border-left: 2px solid #1abc9c;padding: 10px 0 10px 10px;margin: .8em 0;background: #fefefe;word-break:break-all;}","a{color:#25bb9b;text-decoration:none;}"].join(""),items:"source,preview,|,bold,italic,underline,|,bockquote,codeblock,insertorderedlist,insertunorderedlist,|,image,|,table,subscript,superscript,removeformat".split(","),htmlTags:{span:".color,.font-weight,.text-decoration,.vertical-align".split(","),div:"class,id,align,.margin,.padding,.text-align,.color,.font-weight,.text-decoration,.vertical-align".split(","),table:"border,cellspacing,cellpadding,height,align,bordercolor,.padding,.margin,.border,bgcolor,.text-align,.color,.background-color,.font-weight,.text-decoration,.background,.height,.border-collapse".split(","),"td,th":"align,valign,width,height,colspan,rowspan,bgcolor,.text-align,.color,.background-color,.font-weight,.text-decoration,.vertical-align,.background,.border".split(","),a:"href,target,name".split(","),embed:"src,width,height,wmode,name,allowfullscreen,flashvars,type,loop,autostart,quality,.width,.height,align,allowscriptaccess".split(","),object:"classid,width,height,id".split(","),param:"name,value".split(","),img:"class,id,src,width,height,border,alt,title,align,.width,.height,.border".split(","),"p,ol,ul,li,blockquote,h1,h2,h3,h4,h5,h6":"align,.text-align,.color,.font-weight,.text-decoration,.vertical-align,.text-indent,.margin-left".split(","),pre:["class"],hr:"class,.page-break-after".split(","),iframe:"frameborder,width,height,src,allowfullscreen".split(","),"br,tbody,tr,strong,b,sub,sup,em,i,u,strike,s,del":[]}},e=S.extend(d,b.keConf,{placeholder:b.placeholder,afterCreate:function(){a.keEditor=a.keEditor||this,a.fire("afterCreate")},afterChange:function(){a.keEditor=a.keEditor||this,a.waitCreated(function(){a.fire("afterChange")})},afterBlur:function(){a.keEditor=a.keEditor||this,a.fire("afterBlur")},afterFocus:function(){a.keEditor=a.keEditor||this,a.fire("afterFocus")}});if(b.isAdmin&&(e.items="source,preview,|,bold,italic,underline,forecolor,|,bockquote,codeblock,insertorderedlist,insertunorderedlist,link,|,image,|,table,subscript,superscript,removeformat".split(",")),!b.noCodeSelect)for(var f=e.items.length-1;f>=0;f--)"codeblock"===e.items[f]&&e.items.splice(f,1);return e}function L(a,b){if(!a||!b)return!1;var c=!1;b=b.toLowerCase();try{for(;a;){var d=(a.tagName||"").toLowerCase();if(d&&d===b){c=!0;break}a=a.parentNode}}catch(e){}return c}function M(a){var b=this;return b[a]?!0:(b[a]=!0,!1)}function N(){var a=this,b=R(a.getEditorDoc());b.find("#kePlaceholder").remove()}function O(){var a=this,b=a.rawConfig;a.waitCreated(function(){try{var c=(new Date).getTime();if(a._contentLastTime){if(c-a._contentLastTime>cb){var d=a._contentLast||"",e=R.trim(a.val());a._contentLastTime=c,a._contentLast=e,e!==d&&(a.fire("draftChange"),b.draftChange&&b.draftChange.call(a,e))}}else a._contentLastTime=c}catch(f){}})}function P(){var a=this;bb.pluginInited||(bb.pluginInited=!0,Q.plugin("bockquote",function(){var b=this;b.clickToolbar("bockquote",function(){R("#kePlaceholder",b.edit.doc).remove(),b.select();var c=b.cmd.commonNode({blockquote:"*"});if(c){var d=b.cmd.range.createBookmark();c.remove(!0),b.cmd.range.moveToBookmark(d)}else{b.cmd.indent();var c=b.cmd.commonNode({blockquote:"*"});if(c){try{b.cmd.range.selectNodeContents(c),b.cmd.removeformat()}catch(e){}c.removeAttr("style"),!c.next()&&c.after("<br />")}}b.select(),a.fire("afterChange")})}),Q.plugin("codeblock",function(){var b=this;b.clickToolbar("codeblock",function(){R("#kePlaceholder",b.edit.doc).remove(),b.select();var c=b.cmd.commonNode({pre:"*"});if(c){var d=b.cmd.range.createBookmark();c.remove(!0),b.cmd.range.moveToBookmark(d)}else{b.exec("formatblock","<pre>");var c=b.cmd.commonNode({pre:"*"});if(c){try{b.cmd.range.selectNodeContents(c),b.cmd.removeformat()}catch(e){}c.addClass("prettyprint"),!c.next()&&c.after("<br />")}}b.select(),a.fire("afterChange")})}))}a("../../lib/kindeditor");var Q=window.KindEditor,R=a("../../lib/jquery"),S=a("../../lib/underscore"),T=a("../../core/base"),U=a("../../util/dom");a("../../util/util");var V=a("../../util/uploadRemote"),W=a("../../util/cookie"),X=a("../../util/browser"),Y=a("../../core/siteConfig"),Z=a("../menu"),$=a("../select"),_=a("../popup"),ab=a("../../core/component"),bb=c.exports=T.createClass("component.HEditor"),cb=800;T.mix(bb,ab,{xtype:"HEditor",_template:'<div style="position:relative;"></div>',listeners:[{name:"render",type:"custom",handler:function(){var a=this,b=a.rawConfig;a.getEl(),a.initEvent(),a.initFullScreen(),a.initPlaceholder(),a.initAutoLink(),a.initToolbarTips(),a.initChangeEditor(),a.initToolbarFixed(),a.initAutoHeight(),a.initCodeSelect(),a.initShowCodeName(),a.initKeEditor(),a.initPasteUpload(),a.initRemoteUpload(),a.initChangeDefaultAction(),!!b.disabled&&a.disable(),a.resize(b.width,b.height),b.draftChange&&(a._draftChangeTimer=window.setInterval(S.bind(a.logContentChange,a),2*cb))}},{name:"destroy",type:"custom",handler:function(){var a=this;window.clearInterval(a._draftChangeTimer),a._toolbarScrollCb&&R(window).unbind("scroll",a._toolbarScrollCb);try{a.keEditor.remove()}catch(b){}}},{name:"click a.js-2-md",handler:function(){var a=this;a.changeEditor()}}],create:d},{initialize:e,initEvent:f,initKeEditor:g,initFullScreen:h,initPlaceholder:i,initAutoLink:j,initToolbarTips:k,initToolbarFixed:l,initChangeEditor:m,initAutoHeight:n,initCodeSelect:o,initShowCodeName:p,initPasteUpload:q,initRemoteUpload:r,initChangeDefaultAction:s,val:t,text:u,blur:v,focus:w,disable:x,isEmpty:y,resize:z,autoHeight:A,waitCreated:B,changeEditor:C,getEditor:D,getEditorDoc:E,getEditorWin:F,getEditorEl:G,getEditorEditEl:H,getToolbarEl:I,getCmdClosestEl:J,getEditorConf:K,isInTagNode:L,lockInit:M,removePlaceHolder:N,logContentChange:O,_addKEPlugin:P})});
