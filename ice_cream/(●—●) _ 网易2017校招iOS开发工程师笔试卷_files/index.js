define("nowcoder/1.2.582/javascripts/site/cts/test/index",["../../../lib/jquery","../../../lib/underscore","../../../core/base","./manager","../../../core/siteConfig","../../../util/util","../../../util/cookie","../../../util/event","../../../util/nav","../../../component/popup","../../../core/component","../../../component/layer","../../../util/dragdrop","../../../util/browser","./util/util","../../../util/stream","../../../kit/webrtc/adapter","./util/oss","../../../action/cts","../../../util/ajax","./util/chat","../../../util/limit","../../../component/select","../../../util/dom"],function(a){function b(){var a=this,b=f.isSupportCam(),g=window.XMLHttpRequest&&window.Blob&&window.FormData&&window.FileReader;if(!b||!g){var h=c("div.nk-main");return h.html(['<div class="module-box" style="padding:85px 0 85px 0;text-align:center">',"<h2>非常抱歉，你正在使用的浏览器不支持在线笔试</h2>",'<p style="margin:30px 0;color:#747474;font-size:14px;">建议你使用以下浏览器的最新版本打开本页面</p>',"<ul>",'<li style="display:inline-block;">','<img style="width:64px;height:64px;" src="//uploadfiles.nowcoder.com/images/20160303/56_1456989507104_CD25B09FE067A549953AA39965170C89">','<p style="color: #888;margin:10px 0 20px;font-size:14px;">chrome浏览器</p>','<a href="http://www.nowcoder.com/discuss/3793" target="_blank" class="btn btn-primary">下载</a>',"</li>",'<li style="display:inline-block;margin-left:60px;">','<img style="width:64px;height:64px;" src="//uploadfiles.nowcoder.com/images/20160303/56_1456989516332_5882D3A23B5C8B55A0041088E05288D4">','<p style="color: #888;margin:10px 0 20px;font-size:14px;">firefox浏览器</p>','<a href="http://www.nowcoder.com/discuss/3793" target="_blank" class="btn btn-primary">下载</a>',"</li>","</ul>","</div>","</div>"].join("")),void 0}d.copy(a,window,["pageInfo"]);var i=window.manager=new e({data:a.pageInfo});i.launch()}var c=a("../../../lib/jquery");a("../../../lib/underscore");var d=a("../../../core/base"),e=a("./manager"),f=a("./util/util");d.ready({initialize:b})});

define("nowcoder/1.2.582/javascripts/site/cts/test/manager",["../../../lib/jquery","../../../lib/underscore","../../../core/base","../../../core/siteConfig","../../../util/util","../../../util/cookie","../../../util/event","../../../util/nav","../../../component/popup","../../../core/component","../../../component/layer","../../../util/dragdrop","../../../util/browser","./util/util","../../../util/stream","../../../kit/webrtc/adapter","./util/oss","../../../action/cts","../../../util/ajax","./util/chat","../../../util/limit","../../../component/select","../../../util/dom"],function(a,b,c){function d(a){var b=this;b.data=a.data||{};var c=(b.data||{}).paperSetting||{};b.dataStatus={allowCamera:!!c.allow_camera,allowMessage:!!c.allow_message,optionDisorder:!!c.option_disorder,questionDisorder:!!c.question_disorder,antiJumpOut:!!c.antiJumpOut,noQueueUp:!!c.noQueueUp},b.isSupportCam=T.isSupportCam(),b.needCamera=!!b.dataStatus.allowCamera,b.headerEl=L("div.nowcoder-header div.header-main"),b.mainEl=L("div.nk-main"),b.questionMap={},b.stepMap={},b.step,b.stepOrder=[T.STEP_INFO,T.STEP_CAMERA,T.STEP_PROTOCOL,T.STEP_MENU,T.STEP_EXAM],!b.needCamera&&b.stepOrder.splice(1,1),b.router=b.initRoute(),b.initEvent()}function e(){var a=this,b=R.Router.extend({routes:{"":"navStep","/":"navStep",":module":"navStep",":module/:param":"navStep","*error":"navError"},navStep:function(b,c){b=L.trim(b),c=c?window.decodeURIComponent(L.trim(c)):"",a.entryStep(b,P.parseJSON(c,{}))},navError:function(){a.entryStep()}});return new b}function f(){var a=this;Q.listen(T.MSG_EVENT_DID_START_EXAM,function(){M.forEach([T.STEP_INFO,T.STEP_CAMERA,T.STEP_PROTOCOL],function(b){var c=a.getStep(b);c&&(c.destroy(),delete a.stepMap["step"+b])}),a.countTime()}),Q.listen(T.MSG_EVENT_GET_VIDEO_STREAM,function(b){b&&a.needCamera&&(a.showCamera(!0),T.getVideoEl(b,a.headerEl.find("video.js-inner-video")))})}function g(){var a=this;a.dataStatus.allowMessage&&!a.chat&&a.data.userId&&(a.chat=new V({manager:a}))}function h(){var a=this,b=!(!a.needCamera||!a.isSupportCam);a.showCamera(b),b&&a.data.userId&&T.uploadCamImage(a.data.userId,function(b){b&&U.uploadPic({body:{pid:a.data.paperId,tid:a.data.tid,uid:a.data.userId,url:b}})})}function i(){R.history.start()}function j(a,b,c){var d=this;if(a=P.id(L.trim(a)),a&&d.hasStep(a)){var e=d.data.userId;e&&(b=M.extend({uid:e},b)),M.forEach(b,function(a,c){(null===a||void 0===a)&&delete b[c]});var f=b&&M.size(b)>0?window.encodeURIComponent(JSON.stringify(b)):"";f=f?"/"+f:"",d.router.navigate(a+f,M.extend({trigger:!0},c))}}function k(){var a=this,b=a.data;if(!b.tid)return a.nav(T.STEP_INFO),void 0;var c=null,d=0;M.forEach(b.typeStatuses,function(a){"1"===P.id(a.qstatus)&&(d++,c=c||P.id(a.qtype))}),1!==d?a.nav(T.STEP_MENU):a.nav(T.STEP_EXAM,{type:c})}function l(a){var b=this;b.nav(T.STEP_EXAM,a)}function m(){var a=this;a.nav(T.STEP_MENU)}function n(a){var b=this,c=M.extend({},b._navParam,a);M.size(c)>0&&(b.nav(b.currentStep,c,{trigger:!1}),b._navParam=c)}function o(a,b){function c(a){return i?(d.getData(b.type,function(b){a&&a(b)}),void 0):(a&&a(),void 0)}b=b||{};var d=this,e=P.getParam("id"),f=b.uid;if(!e&&f&&!d._noFirstStep){var g=P.addParam({id:f});return window.location.href=g,void 0}d._noFirstStep=!0;var h=a&&d.hasStep(a);if(h=h&&(d.data.tid?[T.STEP_MENU,T.STEP_EXAM].indexOf(a)>=0:[T.STEP_INFO,T.STEP_CAMERA,T.STEP_PROTOCOL].indexOf(a)>=0),h=h&&(a===T.STEP_EXAM?!!P.id(b.type)&&!d.isSubmitType(b.type):!0),!h)return d.navAuto();d._navParam=b,d.changeUserName(),d.initChat(),a!==T.STEP_INFO&&d.initCamera(),d.ping();var i=a===T.STEP_EXAM,j=a===d.currentStep,k=i?T.loadMask("题目加载中..."):null;c(function(c){return!i||c&&b.type?(d.getStepClass(a,b.type,function(e){T.closeMask(k);var f=d.getStep(d.currentStep);!j&&f&&(f.fire("leaveStep"),f.hide()),d.currentStep=a;var g=d.getStep(a);if(!f&&!g&&(d.mainEl.get(0).innerHTML=""),g||(g=new e({step:a,manager:d,renderTo:d.mainEl,listeners:{pre:function(){d.gotoPreStep()},next:function(){d.gotoNextStep()}}}),d.cacheStep(a,g),d.adjustTime()),g.show(),g.fire("entryStep",b.type),T.goTop(),a===T.STEP_MENU){var h=d.getStep(T.STEP_EXAM);h&&h.logTimeDiff(),Q.fire(T.MSG_EVENT_DID_START_EXAM)}else if(i){var l="index"in b?+b.index||0:d.getTypeIndex(c.questions,c.dones);l=l<c.questions.length?l:0,g.loadQuestions({index:l,type:b.type,items:c.questions,dones:c.dones,param:b}),Q.fire(T.MSG_EVENT_DID_START_EXAM)}d.chat&&d.chat.fire("fixSize"),d.changeNavSubmit()}),void 0):(T.closeMask(k),d.nav(T.STEP_MENU))})}function p(a){var b=this;return a&&-1!==b.stepOrder.indexOf(a)}function q(b,c,d){var e=this;if(!e.hasStep(b))return d&&d();var f=b===T.STEP_EXAM,g=f?"./step/exam":"./step/step"+b;a.async(g,function(a){T.changeStyle(b,c,function(){d&&d(a)})})}function r(){var a=this,b=a.stepOrder.indexOf(a.currentStep);b=b>0?b-1:-1;var c=-1===b?-1:a.stepOrder[b];a.nav(c)}function s(){var a=this,b=a.stepOrder.indexOf(a.currentStep);b=b+1<a.stepOrder.length?b+1:-1;var c=-1===b?-1:a.stepOrder[b];a.nav(c)}function t(a){var b=this;if(a)return b.stepMap["step"+a]}function u(a){var b=this,c=b.getStep(T.STEP_EXAM);if(!a)return c;var d=b.currentStep;return d===T.STEP_EXAM?c:void 0}function v(a,b){var c=this;a&&b&&(c.stepMap["step"+a]=b)}function w(a,b){if(b=b||[],a=a||[],0===b.length)return 0;var c={};M.forEach(b,function(a){var b=P.id(a.qid);b&&(c[b]=!0)});for(var d=0,e=a.length;e>d;d++){var f=a[d],g=P.id(f.qid);if(g&&!c[g])return d}return 0}function x(a,b){var c=this;if(c._dataCache=c._dataCache||{},a=P.id(a),!a||c._dataCache[a])return b&&b(a?c._dataCache[a]:null);var d=T.getSeedFromStr(c.data.userId+"");U.getQuestions({query:{type:a,tid:c.data.tid},params:{paperId:c.data.paperId},call:function(e){var f=e.data,g=O.questionType,h=f.questions;c.dataStatus.questionDisorder&&(a===P.id(g.danxuan)||a===P.id(g.duoxuan)||a===P.id(g.tiankong))&&(h=T.resortItems(d,h)),M.forEach(h,function(a){var b=a.type;(b===g.danxuan||b===g.duoxuan)&&c.dataStatus.optionDisorder&&(a.answers=T.resortItems(d,a.answers))});var i={};M.forEach(f.dones,function(a){try{a.usercontent=JSON.parse(a.usercontent)}catch(b){a.usercontent={}}var c=!0;M.forEach(a.usercontent,function(a){c=c&&!a}),c||(i[a.qid+""]=a)}),c._dataCache[a]={questions:h,dones:i},b&&b(c._dataCache[a])},error:function(a){S.alert(a.msg),b&&b()}})}function y(a){var b=this;if(a=P.id(a),!a)return!0;for(var c=b.data.typeStatuses||[],d=0,e=c.length;e>d;d++){var f=c[d];if(P.id(f.qtype)===a&&2===f.qstatus)return!0}return!1}function z(){var a=this,b=a.getExamStep(!0);if(b){var c=b.items,d=b.currentIndex;return c[d]}}function A(){return!!T.localMediaStream}function B(){var a=this;return window.clearTimeout(a._countTimer),a.data.leftSeconds<0?(a.finishPaper(),void 0):(a.data.leftSeconds--,a.adjustTime(),a._countTimer=window.setTimeout(M.bind(a.countTime,a),1e3),void 0)}function C(){function a(){U.pingTest({body:{pid:b.data.paperId,tid:b.data.tid,uid:b.data.userId,timeDiff:JSON.stringify(b.timeDiff||{})},call:function(d){var e=d.data;b.timeDiff={},"leftSeconds"in e&&(b.data.leftSeconds=+e.leftSeconds||0),window.setTimeout(a,c),(+e.newMsgCount||0)>0&&b.chat&&b.chat.checkMsg()},error:function(){window.setTimeout(a,c)}})}var b=this,c=8e3;!b._ping&&b.data.userId&&(b._ping=!0,a())}function D(a,b){var c=this;if(a=L.trim(a),b=+b||0,a&&0!==b){var d=c.timeDiff||{};d[a]=(d[a]||0)+b,c.timeDiff=d}}function E(a){var b=this,c="正在提交...",d=T.loadMask(c);a=P.id(a),U.finishTest({body:{tid:b.data.tid,pid:b.data.paperId,type:a,isAll:!1},call:function(){T.closeMask(d),M.forEach(b.data.typeStatuses,function(b){P.id(b.qtype)===a&&(b.qstatus=2)}),b.nav(T.STEP_MENU),S.tips("提交成功")},error:function(){T.closeMask(d),S.alert("提交失败，请重试")}})}function F(a){function b(){d._finishTimer=window.setTimeout(function(){return i--,0>=i?(k.html("正在提交，请等待..."),c()):(k.html("考试时间结束，正在排队交卷中，请耐心等待"+i+'秒...<div style="font-size:12px;">如果本次提交失败，系统将自动补交，直至交卷成功。</div>'),b(),void 0)},1e3)}function c(){U.finishTest({body:{tid:f,pid:g,type:h,isAll:!0},call:function(){T.closeMask(j),S.tips("提交成功",2e3),window.setTimeout(function(){window.location.reload()},1e3)},error:function(){d._finishPaperCount<=5?window.setTimeout(function(){T.closeMask(j),d.finishPaper(!0)},750):window.location.reload()}})}var d=this,e=d.getExamStep(!0);e&&(e.submitAnswer(),e.sendAnswer()),d._finishTimer&&window.clearTimeout(d._finishTimer),d._finishPaperCount=(d._finishPaperCount||0)+1;var f=d.data.tid,g=d.data.paperId,h=(e||{}).type,i=T.randomSecond(30),j=T.loadMask(a?"正在提交，请等待...":"考试时间结束，正在排队交卷中，请耐心等待"+i+'秒...<div style="font-size:12px;">如果本次提交失败，系统将自动补交，直至交卷成功。</div>'),k=j.getEl().find("span.warning-word");d._finishPaperCount<=1&&!a?b():window.setTimeout(c,250)}function G(){var a=this,b=0;return M.forEach(a.data.typeStatuses,function(a){b+=2!==a.qstatus?1:0}),1>=b}function H(){var a=this,b=a.currentStep;if(b){var c=a.headerEl,d=c.find("button.js-test-submit");return b===T.STEP_MENU||b===T.STEP_EXAM?(0===d.length&&(d=L('<button class="js-test-submit btn btn-important btn-sm test-submit">交卷</button>'),c.find("div.written-name").before(d),d.on("click",function(b){b.preventDefault(),S.confirm("交卷后您的本场考试将结束，您将无法再返回修改作答，是否确定交卷？",M.bind(a.finishPaper,a,!0))})),void 0):(d.remove(),void 0)}}function I(){var a=this,b=L.trim((a.data.user||{}).name);if(b){var c=a.headerEl,d=c.find("div.written-name");0===d.length&&(d=L(['<div class="written-name no-camera">','<div><span class="js-user-name"></span> <i class="icon-angle-down"></i><i class="icon-angle-up"></i></div>','<div class="written-video"><video class="written-video-inner js-inner-video"></video></div>',"</div>"].join("")),c.append(d),a.needCamera&&d.on("click",function(){T.getVideoStream(function(a,b){(a||!b)&&T.popupPermission()})})),d.find("span.js-user-name").html("考生: "+N.encodeHTML(b))}}function J(a){var b=L("div.nowcoder-header .header-main"),c=b.find("div.written-name");c[a===!1?"addClass":"removeClass"]("no-camera")}function K(){var a=this;Q.fire(T.MSG_EVENT_TIME_CHANGE,a.data.leftSeconds)}var L=a("../../../lib/jquery"),M=a("../../../lib/underscore"),N=a("../../../core/base"),O=a("../../../core/siteConfig"),P=a("../../../util/util"),Q=a("../../../util/event"),R=a("../../../util/nav"),S=a("../../../component/popup"),T=a("./util/util"),U=a("../../../action/cts"),V=a("./util/chat"),W=c.exports=N.createClass("site.cts.test.manager");M.extend(W.prototype,Q,{initialize:d,initRoute:e,initEvent:f,initChat:g,initCamera:h,launch:i,nav:j,navAuto:k,navExam:l,navMenu:m,addNavParam:n,entryStep:o,hasStep:p,getStepClass:q,gotoPreStep:r,gotoNextStep:s,getStep:t,getExamStep:u,cacheStep:v,getTypeIndex:w,getData:x,isSubmitType:y,getCurrentQuestion:z,hasStream:A,countTime:B,ping:C,addTimeDiff:D,submitTest:E,finishPaper:F,isLastType:G,changeNavSubmit:H,changeUserName:I,showCamera:J,adjustTime:K})});

define("nowcoder/1.2.582/javascripts/site/cts/test/util/chat",["../../../../lib/jquery","../../../../lib/underscore","../../../../util/util","../../../../util/cookie","../../../../util/limit","../../../../core/base","../../../../core/component","../../../../util/event","../../../../component/select","../../../../util/dom","../../../../util/browser","../../../../action/cts","../../../../util/ajax","../../../../core/siteConfig"],function(a,b,c){function d(a){var b=this;b.manager=a.manager,b.msgMap={},a.renderTo=t(a.renderTo||document.body),A.superClass.initialize.call(b,a)}function e(){var a=this,b=a.rawConfig,c=t('<div class="code-question-pannel"><i class="ico-q-msg"></i><span>考试问题咨询</span><a class="icon-angle-up"></a></div>');b.renderTo.append(c),a.holderEl=c,c.on("click",function(b){b.preventDefault(),b.stopPropagation(),a.open()})}function f(){var a=this,b=a.getEl();a.typeSelect=new y({renderTo:b.find("#jsType"),renderBy:"replaceWith",cls:"btn-group-xs",options:[{text:"题目问题",value:"1",checked:!0},{text:"系统问题",value:"2"},{text:"考试结果/后期面试",value:"3"},{text:"其他",value:"4"}],render:function(){this.getEl().width(150)}})}function g(){var a=this;a.rawConfig;var b=a.getEl();b.find("textarea.pannel-chat-txt").on("keydown",function(b){if(13===b.keyCode){b.preventDefault();var c=t(b.currentTarget);a.sendMsg(c.val()),c.val("")}}),t(document).on("click",function(c){var d=c.target;a.isOpen()&&d!==b.get(0)&&!t.contains(b.get(0),d)&&a.open(!1)})}function h(){function a(){if(i&&window.clearTimeout(i),b._stopFixBottom)return j=0,void 0;if(0===j)i=window.setTimeout(function(){f=e.height(),h=g.position().top;var a=e.scrollTop(),i=a+f-d;j=i>h?i-h:0,c.css("bottom",j),b.holderEl.css("bottom",j)},15);else{f=e.height(),h=g.position().top;var a=e.scrollTop(),k=a+f-d;j=k>h?k-h:0,c.css("bottom",j),b.holderEl.css("bottom",j)}}var b=this;if(!b._fixBottom){b._fixBottom=!0;var c=b.getEl(),d=0,e=t(window),f=e.height(),g=t("div.nk-container div.ft-wrap"),h=g.position().top;g.height();var i=null,j=0;a(),b.open(!1),e.on("scroll",a),e.on("resize",function(){f=e.height(),a()}),b.listen("fixSize",function(){a()})}}function i(a,b,c){var d=this,e=d.listEl,f=b?"客服":"我";if(a=t.trim(a)){var g=b?['<div class="pcl-item clearfix">','<div class="pcl-head">','<a class="list-head" href="javascript:void(0);"><img alt="头像" src="//uploadfiles.nowcoder.com/images/20160711/56_1468219359225_DFC72C14F1C7419B93207CC1C1A560C9"></a>','<span class="pcl-name">#{name}</span>',"</div>",'<div class="tooltip fade right in">','<div class="tooltip-arrow" style="top:18px;"></div>','<div class="tooltip-inner letter-chat clearfix">#{msg}</div>',"</div>","</div>"].join(""):['<div class="pcl-item ask-item clearfix">','<div class="pcl-head">','<a class="list-head" href="javascript:void(0);"><img alt="头像" src="//uploadfiles.nowcoder.com/images/20160712/58_1468318308479_449C3253CA2BBED9314D39977A486D0E"></a>','<span class="pcl-name">#{name}</span>',"</div>",'<div class="tooltip fade right in">','<div class="tooltip-arrow" style="top:18px"></div>','<div class="tooltip-inner letter-chat clearfix">#{msg}</div>',"</div>","</div>"].join(""),h=w.execTpl(g,{name:f,msg:a},!!c||!b);e.append(h),d.bottomMsg()}}function j(a){var b=this;if(a=a||"",/^\d+$/.test(a)&&b._autoMsg){var c=+a-1;if(!(0>c||c>=b._autoMsg.length)){var d=b._autoMsg[c];return b.showMsg(d.answer||"",!0),!0}}}function k(a){var b=this,c=b.getEl(),d="考试问题咨询"+(a?"(您有未读信息)":"");b.titleEl.html(d),c[a?"addClass":"removeClass"]("has-new-msg"),b.holderEl[a?"addClass":"removeClass"]("new-msg-notice")}function l(){var a=this,b=a.listEl,c=b.parent(),d=c.height(),e=b.height();e>d&&c.scrollTop(e-d)}function m(a){var b=this,c=b.getEl();a===!1?c.hide(50,function(){c.removeClass("open"),b.holderEl.show(100)}):(b.holderEl.hide(50,function(){c.addClass("open").show(100),b.txtIpt.focus()}),b.showTitle(!1)),b._isNoFirstOpen||(b._isNoFirstOpen=!0,b.showTips())}function n(){var a=this,b=a.getEl();return b.hasClass("open")}function o(a){var b=this,c=b.manager,d=c.getCurrentQuestion(),a=t.trim(a);a&&z.newMessage({body:{uid:c.data.userId,pid:c.data.paperId,qid:(d||{}).qid,content:a,type:b.typeSelect.val()},call:function(c){var d=c.data+"";b.msgMap[d]={content:a,id:c.data,isSelf:!0},b.showMsg(a)},error:function(){b.showMsg("消息“ "+a+" ”发送失败",!0,!0)}})}function p(a){var b=this,c=b.manager;b._requesting||(b._requesting=!0,a=+a||1,z.listmessage({query:{uid:c.data.userId,page:+a||1},call:function(c){var d=c.data,e=+d.totalPage||1,f=d.messages||[];u.forEach(f,function(a){var c=a.id+"",d=t.trim(a.content);!b.msgMap[c]&&d&&(b.msgMap[c]=a,b.showMsg(d,!0))}),f.length>0&&!b.isOpen()&&b.showTitle(!0),b._requesting=!1,e>a&&b.checkMsg(a+1)},error:function(){b._requesting=!1}}))}function q(a){var b=this;b._stopFixBottom=a!==!1}function r(){function a(){var a=["欢迎参加在线考试。如果你遇到以下问题，可以直接点击查看哦！"];u.forEach(b._autoMsg,function(b,c){a.push(w.execTpl('<a class="js-auto-msg link-green" href="javascript:void(0);" data-index="#{order}">#{order}:#{content}</a>',{order:c+1,content:b.question},!0))}),a.push("如以上问题未能解决你的困难，请选择你遇到的问题类别并进行详细描述，我将尽快为你解答。"),a=u.map(a,function(a){return"<p>"+a+"</p>"});var c='<div class="pcl-item">'+a.join("")+"</div>";b.showMsg(c,!0)}var b=this,c=b.manager;b._autoMsg?a():b._isGetAutoMsg||(b._isGetAutoMsg=!0,z.listFaq({query:{pid:c.data.paperId},call:function(c){b._autoMsg=c.data,a()},always:function(){b._isGetAutoMsg=!1}}))}function s(a){return{open:a.open?"open":""}}var t=a("../../../../lib/jquery"),u=a("../../../../lib/underscore");a("../../../../util/util");var v=a("../../../../util/limit"),w=a("../../../../core/base"),x=a("../../../../core/component"),y=a("../../../../component/select"),z=a("../../../../action/cts"),A=c.exports=w.createClass("site.cts.test.util.chat");w.mix(A,x,{xtype:"chat",_template:['<div class="subject-oprt-wrap pannel-chat #{open}" style="display:none;">','<div class="oprt-hd">','<div class="s-pannel-oprt"><a class="icon-angle-up"></a></div>','<span class="s-pannel-title">考试问题咨询</span>',"</div>",'<div class="oprt-bd">','<div class="pannel-chat-list"><div id="jsList"></div></div>','<div class="pannel-chat-type clearfix">','<div role="group" class="btn-group btn-group-xs" id="jsType"></div>','<a href="javascript:void(0);" class="js-show-auto-msg link-green" style="display:inline-block;float:right;font-size:12px;">常见问题</a>',"</div>",'<textarea class="pannel-chat-txt" id="jsTxtIpt"></textarea>',"</div>","</div>"].join(""),listeners:[{name:"render",type:"custom",handler:function(){var a=this,b=a.getEl();a.rawConfig,a.initHolderEl(),a.initComponent(),a.initEvent(),a.titleEl=b.find("div.oprt-hd span.s-pannel-title"),a.listEl=b.find("#jsList"),a.txtIpt=b.find("#jsTxtIpt"),a.fixBottom(),b.on("click",function(){a.showTitle(!1)})}},{name:"click div.oprt-hd",handler:function(){var a=this;a.open(!a.isOpen())}},{name:"click #jsList a.js-auto-msg",handler:function(a){var b=this,c=t(a.currentTarget),d=c.attr("data-index");return b.showAutoReply(d)}},{name:"click a.js-show-auto-msg",handler:function(a){var b=this,c=t(a.currentTarget);v.mark(c)||(b.showTips(),window.setTimeout(function(){v.clear(c)},2500))}}]},{initialize:d,initHolderEl:e,initComponent:f,initEvent:g,fixBottom:h,showMsg:i,showAutoReply:j,showTitle:k,bottomMsg:l,showTips:r,open:m,isOpen:n,sendMsg:o,checkMsg:p,stopFixBottom:q,_getData:s})});

define("nowcoder/1.2.582/javascripts/site/cts/test/util/example",["../../../../lib/jquery","../../../../lib/underscore","../../../../core/base","../../../../util/util","../../../../util/cookie"],function(a,b,c){function d(a){return a=e.id(a),a?f[a]||[]:[]}a("../../../../lib/jquery"),a("../../../../lib/underscore"),a("../../../../core/base");var e=a("../../../../util/util"),f={4:[{qid:"example",score:0,type:4,title:"考试输入输出规范示例",content:"求a+b的和",ext:{cTemplate:"",codingProblemId:12445,codingType:"0",cppTemplate:"#include <iostream>\nusing namespace std;\nint main() {\n    int a,b;\n    while(cin >> a >> b)//注意while处理多个case\n        cout << a+b << endl;\n}",csharpTemplate:"public class Program {\n  public static void Main() {\n    string line;\n    while ((line = System.Console.ReadLine ()) != null) {//注意while处理多个case\n      string[] tokens = line.Split();\n      System.Console.WriteLine(int.Parse(tokens[0]) + int.Parse(tokens[1]));\n    }\n  }\n}",javaTemplate:"import java.util.Scanner;\npublic class Main {\n    public static void main(String[] args) {\n        Scanner in = new Scanner(System.in);\n        while (in.hasNextInt()) {//注意while处理多个case\n            int a = in.nextInt();\n            int b = in.nextInt();\n            System.out.println(a + b);\n        }\n    }\n}",jsTemplate:"process.stdin.resume();\nprocess.stdin.setEncoding('ascii');\n\nvar input = \"\";\nvar input_array = \"\";\n\nprocess.stdin.on('data', function (data) {\n    input += data;\n});\n\nprocess.stdin.on('end', function () {\n    input_array = input.split(\"\\n\");\n    var nLine = 0;\n\n    while(nLine < input_array.length){\n    	var line = input_array[nLine++].trim();\n    	if(line === ''){\n    		continue;\n    	}\n        var input_arrays = line.split(' ');\n        var a = +input_arrays[0];\n        var b = +input_arrays[1];\n        console.log(a+b);\n    }\n});",pythonTemplate:"import sys \nfor line in sys.stdin:\n    a = line.split()\n    print int(a[0]) + int(a[1])",hint:"",inputDesc:"",inputSample:"",memoryLimit:32768,outputDesc:"",outputSample:"",supportLang:"java,cpp",timeLimit:1}}]};c.exports={getByType:d}});

define("nowcoder/1.2.582/javascripts/site/cts/test/util/oss",["../../../../lib/jquery","../../../../lib/underscore","../../../../core/base","../../../../util/util","../../../../util/cookie","../../../../action/cts","../../../../util/ajax","../../../../core/siteConfig"],function(a,b,c){function d(a){var b=this;b.rawConfig=a,b.tokenCb=[]}function e(a){var b=this;b.getToken(function(b){var c=b.endpoints,d=/^https:/.test(window.location.href),c=(c||"").replace(/^https:/,"").replace(/^http:/,"");c=(d?"https:":"http:")+c;var e=new window.ALY.OSS({accessKeyId:b.accessKeyId,secretAccessKey:b.accessKeySecret,securityToken:b.securityToken,endpoint:c,apiVersion:"2013-10-15"});a&&a(e,b)})}function f(a,b){var c=this,d=c.rawConfig,e=c.cacheToken;if(e){var f=(new Date).getTime(),g=e.createdAt;if(f+6e5<=g+e.expiration)return a&&a(e)}c.tokenCb.push(a),c.tokenCb.length>1&&!b||k.getOssCredential({query:{uid:d.uid},call:function(a){var b=a.data;b.createdAt=(new Date).getTime(),c.cacheToken=b,i.forEach(c.tokenCb,function(a){a&&a(b)}),c.tokenCb.length=0},error:function(){c.cacheToken?a&&a(c.cacheToken):window.setTimeout(function(){c.getToken(null,!0)},1e4)}})}function g(a,b,c){var d=this;d.getOss(function(e,f){try{var g=new window.FileReader;g.onload=function(g){var h=f.path+"/"+(new Date).getTime()+"_"+d.getRandomName();e.putObject({Bucket:f.bucket,Body:g.target.result,Key:h,ContentType:a.type||b,CacheControl:"public"},function(a){c&&c(a?"":"http://uploadfiles.nowcoder.com/"+h)})},g.readAsArrayBuffer(a)}catch(h){c&&c()}})}function h(a){a=a||32;for(var b="",c="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890",d=c.length,e=0;e++<a;)b+=c.charAt(Math.floor(Math.random()*d));return b}a("../../../../lib/jquery");var i=a("../../../../lib/underscore"),j=a("../../../../core/base");a("../../../../util/util");var k=a("../../../../action/cts"),l=c.exports=j.createClass("site.cts.test.util.oss");i.extend(l.prototype,{initialize:d,getOss:e,getToken:f,uploadBlob:g,getRandomName:h})});

define("nowcoder/1.2.582/javascripts/site/cts/test/util/util",["../../../../lib/jquery","../../../../lib/underscore","../../../../util/util","../../../../util/cookie","../../../../util/event","../../../../util/stream","../../../../component/popup","../../../../core/base","../../../../core/component","../../../../component/layer","../../../../util/dragdrop","../../../../util/browser","../../../../kit/webrtc/adapter","./oss","../../../../action/cts","../../../../util/ajax","../../../../core/siteConfig"],function(a,b,c){function d(a,b){var c=this;b=b&&b.length>0?b:[];var d=c.random(a,b.length),e=x.map(d,function(a){return b[a]});return e}function e(a,b){function c(b,c){a=(9301*a+49297)%233280;var d=a/233280;return b+d*(c-b)}var d=[],e={};for(b=Math.max(b,1);d.length<b;){var f=Math.round(c(0,b-1)),g=f+"";e[g]||(d.push(f),e[g]=1)}return d}function f(a){a=w.trim(a);for(var b=0,c=0,d=a.length;d>c;c++)b+=a.charCodeAt(c);return b}function g(a){return a=Math.max(1,+a||1),Math.floor(Math.random()*a+1)}function h(a){var b=this;if(!b.isSupportCam()){var c="浏览器版本过低",d=window.Error?new window.Error(c):{message:c};return a&&a(d)}if(b.localMediaStream)return a&&a(null,b.localMediaStream);var e=b._getVideoStreamCb=b._getVideoStreamCb||[];e.push(a),e.length>1||C.getUserMedia({video:!0,audio:!1},function(a){b.localMediaStream=a,x.forEach(e,function(b){b&&b(null,a)}),e.length=0,z.fire(b.MSG_EVENT_GET_VIDEO_STREAM,a)},function(a){b.localMediaStream=null,x.forEach(e,function(b){b&&b(a)}),e.length=0})}function i(a,b){if(b=w(b).get(0)||document.createElement("video"),a){b.oncontextmenu=function(a){a.preventDefault()},x.forEach(["","moz","webkit","o","ms"],function(a){var c=a?a+"Transform":"transform";b.style[c]="scaleX(-1)"});try{C.attachMediaStream(b,a)}catch(c){}return b.autoplay="autoplay",b.muted=!0,b.play(),b}}function j(a){var b=this,c=document.createElement("canvas");c.width=F,c.height=G;var d=c.getContext("2d"),e=w("#jsTmpImageVideo");if(0===e.length)e=b.getVideoEl(b.localMediaStream),e.id="jsTmpImageVideo",w(document.body).append(e),w(e).hide(),e.play(),window.setTimeout(function(){d.drawImage(e,0,0,F,G);var b=c.toDataURL("image/jpeg",H);a&&a(b,c)},1e3);else{d.drawImage(e.get(0),0,0,F,G);var f=c.toDataURL("image/jpeg",H);a&&a(f,c)}}function k(a,b,c){function d(){e.getVideoStream(function(d,g){return g?(e.getImageData(function(c){return A.isPhotoPass(w("#jsTmpImageVideo"),F,G)?(e.uploadImageByImageData(c,a,b),e.uploadCamImage(a,b,f),void 0):(e.uploadCamImage(a,b,f),void 0)}),void 0):e.uploadCamImage(a,b,c)})}var e=this,f=4e4;c=c||1e3*Math.floor(5*Math.random()+1),e._uploadImageTimer&&window.clearTimeout(e._uploadImageTimer),e._uploadImageTimer=window.setTimeout(d,c)}function l(){var a=this;a._uploadImageTimer&&window.clearTimeout(a._uploadImageTimer)}function m(a,b,c){function d(a,b){for(var c,d,f=a.replace(/[^A-Za-z0-9\+\/]/g,""),g=f.length,h=b?Math.ceil((3*g+1>>2)/b)*b:3*g+1>>2,i=new Uint8Array(h),j=0,k=0,l=0;g>l;l++)if(d=3&l,j|=e(f.charCodeAt(l))<<18-6*d,3===d||1===g-l){for(c=0;3>c&&h>k;c++,k++)i[k]=255&j>>>(24&16>>>c);j=0}return i}function e(a){return a>64&&91>a?a-65:a>96&&123>a?a-71:a>47&&58>a?a+4:43===a?62:47===a?63:0}var f=this,g="";if(a&&a.match(/^data\:image\/(\w+)/)&&(g=RegExp.$1),g){new XMLHttpRequest;var h=a.replace(/^data\:image\/\w+\;base64\,/,""),i=new Blob([d(h)],{type:"image/"+g});try{var j=f.oss=f.oss||new E({uid:b});j.uploadBlob(i,"image/jpeg",function(a){c&&c(a)})}catch(k){}}}function n(a,b,c){var d=this,e=d.getStylePath();if(!e)return c&&c();var f=["writtenTest/writtenTest.css","writtenTest/writtenTestStart.css","writtenTest/writtenTestExercise.css","writtenTest/writtenTestCode.css"],g=[],e=d.getStylePath();a===d.STEP_MENU?g.push(f[1]):a===d.STEP_EXAM?(g.push(f[1]),"4"===y.id(b)?g.push(f[3]):g.push(f[2])):g.push(f[0]),d.requireCssByName(g,function(){var a=w("link[rel=stylesheet]");x.forEach(a,function(a){a=w(a);var b=a.attr("href"),c=!1,d=!1;x.forEach(f,function(a){b.indexOf(a)>=0&&(c=!0)}),x.forEach(g,function(a){b.indexOf(a)>=0&&(d=!0)}),c&&!d&&a.remove()}),x.forEach(g,function(b){var c=!1;x.forEach(a,function(a){var d=w(a).attr("href");d.indexOf(b)>=0&&(c=!0)}),!c&&w("head").append('<link rel="stylesheet" href="'+e+b+'">')}),c&&c()})}function o(a,b){var c=this,a=y.isArray(a)?a:[a],d=0,e=c.getStylePath();a=a.slice(0);var f=w("link[rel=stylesheet]");return x.forEach(f,function(b){b=w(b);for(var c=b.attr("href"),d=0,e=a.length;e>d;d++)if(c.indexOf(a[d])>=0){a.splice(d,1);break}}),0===a.length?b&&b():(x.forEach(a,function(c){seajs.request(e+c,function(){d++,d>=a.length&&b&&b()})}),void 0)}function p(){var a=this;if(a.stylePath)return a.stylePath;for(var b=["writtenTest/writtenTest.css","writtenTest/writtenTestStart.css","writtenTest/writtenTestExercise.css","writtenTest/writtenTestCode.css"],c=w("link[rel=stylesheet]"),d=0,e=c.length;e>d;d++){var f=w(c[d]),g=w.trim(f.attr("href"));if(g)for(var h=0,i=b.length;i>h;h++){var j=b[h];if(g.indexOf(j)>=0)return a.stylePath=g.replace(j,""),a.stylePath}}}function q(){w(window).scrollTop(0)}function r(){return!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)}function s(a,b,c){var d=this,e=(a||{}).paperSetting||{},f=[];x.forEach([{type:1,name:"单选"},{type:2,name:"多选"},{type:3,name:"填空"},{type:4,name:"编程"},{type:5,name:"问答"},{type:"6",name:"设计"}],function(b){var c=a.paperTypeCount[b.type]||0;c&&f.push(b.name+"题"+c+"道")});var g="",h=b.indexOf(c),i={};return i[d.STEP_INFO]="确认考生信息",i[d.STEP_CAMERA]="调试摄像头",i[d.STEP_PROTOCOL]="阅读考试须知",i[d.STEP_MENU]="开始答题",x.forEach(b,function(a,b){i[a]&&(g+=D.execTpl(['<div class="item #{cls}">','<div class="step-num-wrap"><div class="step-num">#{index}</div></div>','<h3 class="steps-tit">#{name}</h3>',"</div>"].join(""),{cls:b===h?"done":"",index:b+1,name:i[a]}))}),D.execTpl(['<div class="ecom-info clearfix">','<a href="javascript:void(0);" class="ecom-logo"><img src="#{logo}" /></a>','<div class="ecom-main"><h2 class="ecom-title">#{paperName}</h2><p>考试时间：#{examTime}</p><p>考试题型：#{count}</p></div>',"</div>",'<div class="steps-wrap">#{list}</div>'].join(""),{examTime:a.examTime,paperName:a.paperName,count:f.join("，"),logo:e.logo,list:g})}function t(a){return new B({hasNoTitle:!0,hasNoMove:!0,hasNoFooter:!0,content:['<div class="confirm-content">','<div class="poptip-word"><span class="warning-word">',a||"","</span></div>","</div>"].join(""),width:500,clickToHide:!1})}function u(a){try{a&&a.close()}catch(b){}}function v(){var a=['<div class="pop-video-interview">','<div class="video-res-tips error"><i class="icon-exclamation-sign"></i>你的设备无法启用，请参考以下任一方案，然后继续：</div>','<div class="pop-video-main">',"<ul>","<li>1. 请检查你的摄像头是否连接正常？</li>",'<li>2. 浏览器地址栏附近是否出现<img src="//uploadfiles.nowcoder.com/images/20160706/56_1467799550047_E36B978A3BFAFCF3E1E0A81C3C5D9133">图标，点击查看是否对摄像头设置了禁用。</li>',"<li>3. 启用或者更换你的视频设备。</li>","</ul>",'<img style="width:622px;height:227px;" src="//uploadfiles.nowcoder.com/images/20160706/56_1467799001381_B17356A9B5F14EDD7B9B69ECFE2C261F">',"</div>",'<div style="margin-top:20px;">请按以上方法处理后刷新页面</div>',"</div>"].join("");new B({title:"友情提示",content:a,width:800,hasNoFooter:!0})}var w=a("../../../../lib/jquery"),x=a("../../../../lib/underscore"),y=a("../../../../util/util"),z=a("../../../../util/event"),A=a("../../../../util/stream"),B=a("../../../../component/popup"),C=a("../../../../kit/webrtc/adapter"),D=a("../../../../core/base"),E=a("./oss"),F=420,G=3*F/4,H=.6;c.exports={STEP_INFO:"0",STEP_CAMERA:"1",STEP_PROTOCOL:"2",STEP_MENU:"3",STEP_EXAM:"4",MSG_EVENT_TIME_CHANGE:"MSG_EVENT_TIME_CHANGE",MSG_EVENT_DID_START_EXAM:"MSG_EVENT_DID_START_EXAM",MSG_EVENT_GET_VIDEO_STREAM:"MSG_EVENT_GET_VIDEO_STREAM",resortItems:d,random:e,getSeedFromStr:f,randomSecond:g,getVideoStream:h,getVideoEl:i,getImageData:j,uploadCamImage:k,stopUploadCamImage:l,uploadImageByImageData:m,changeStyle:n,requireCssByName:o,getStylePath:p,goTop:q,isSupportCam:r,getStepHeader:s,loadMask:t,closeMask:u,popupPermission:v}});

define("nowcoder/1.2.582/javascripts/site/cts/test/step/exam",["../../../../lib/jquery","../../../../lib/underscore","../../../../util/util","../../../../util/cookie","../../../../util/event","../../../../util/browser","../util/util","../../../../util/stream","../../../../component/popup","../../../../core/base","../../../../core/component","../../../../component/layer","../../../../util/dragdrop","../../../../kit/webrtc/adapter","../util/oss","../../../../action/cts","../../../../util/ajax","../../../../core/siteConfig","../util/example","../../../../util/littleAction","../../../../util/limit","../../../../util/dom","../../../../action/contest","../../../../action/note","../../../../util/highlighter","../../../../lib/syntaxhighlighter/shCore","../../../../lib/syntaxhighlighter/style/shCoreDefault.css","../../../../component/checkgroup","../../../../component/checkbox","../../../../util/upload","../../../../lib/swfupload","../../../../action/code"],function(a,b,c){function d(a){var b=this;b.manager=a.manager,b.typeModuleMap={},J.superClass.initialize.call(b,a)}function e(){var a=this;a.manager,A.listen(C.MSG_EVENT_TIME_CHANGE,function(b){var c=a.getQuestionModule(a.type);c&&c.showTime(b)})}function f(a){var b=this;b.manager,b.currentIndex=null,b.currentExampleIndex=null,b.items=a.items||[],b.dones=a.dones||{},b.type=a.type,b.examples=D.getByType(a.type),b.answers=[],b.sendingAnswers={};var c=a.param,d=b.examples.length>0&&!z.id(c.index);b.gotoQuestion(d?+c.exampleIndex||0:a.index,d)}function g(a,b){var c=this;c.getEl();var d=c.manager,e=c.items.length,f=(c.examples||[]).length;if(a=a||0,c.submitAnswer(),c[b?"currentExampleIndex":"currentIndex"]===a||a>=(b?f:e))return c.gotoMenu(),void 0;var g=c[b?"examples":"items"][a],h=g.type;b?(d.addNavParam({index:null,exampleIndex:a}),c.logTimeDiff(),c.currentIndex=null,c.currentExampleIndex=a):(d.addNavParam({index:a,exampleIndex:null}),c.logTimeDiff(g.qid),c.currentIndex=a,c.currentExampleIndex=null),c.showQuestion(h,function(d){d.showExample(b),d.showPager(e,f),d.showQuestion(g,c.getDoneContent(g.qid),b),d.showNextAndSubmit(a,e,f,b),d.showPagerDone(),d.showProgress(a,e,f,b)}),C.goTop()}function h(b,c){function d(a){y.forEach(f,function(b){a!==b&&b.hide()}),a.show(),c&&c(a)}var e=this;e.manager;var f=e.typeModuleMap,g=e.getTypeKey(b),h=e.getQuestionModule(b);return h?(d(h),void 0):(a.async("../exam/type"+b,function(a){var b=new a({renderTo:e.getEl(),manager:e.manager,module:e,listeners:{gotoQuestion:function(a,b){e.gotoQuestion(a,b)},gotoNext:function(a){if(a){var b=e.currentExampleIndex+1,c=b<e.examples.length;c&&e.gotoQuestion(b,!0),!c&&e.gotoQuestion(0)}else{var b=e.currentIndex+1;b<e.items.length&&e.gotoQuestion(b)}},gotoMenu:function(){e.gotoMenu()},gotoSubmit:function(){e.clickSubmit()}}});f[g]=b,d(b)}),void 0)}function i(){var a=this,b=a.currentIndex;return a.items[b]}function j(a){var b=this;if(a){var c=b.getTypeKey(a);return b.typeModuleMap[c]}}function k(a){return"question"+a}function l(){var a=this,b=a.manager,c=a.currentIndex;if(z.id(c)){var d=a.items[c];if(d){var e=d.type,f=z.id(d.qid),g={qid:d.qid,tid:b.data.tid},h=!1,i=a.getQuestionModule(e);if(i&&f){var j=a.getDoneContent(d.qid);if(e===K||e===L||e===M){var k=i.val(),h=(j||{content:""}).content!==k;e===K&&(h=k&&(j||{}).content!==k),h&&(a.dones[f]={qid:d.qid,usercontent:{content:k}},g.content=k)}else if(e===O){var k=i.val();h=(j||{}).content!==k,h&&(a.dones[f]={qid:d.qid,usercontent:{content:k,urls:""}},g.content=k)}if(h){for(var l=a.answers,m=l.length-1;m>=0;m--){var n=l[m];n.qid===g.qid&&l.split(m)}a.answers.push(g),a.sendAnswer()}}}}}function m(a){var b=this,c=b.sendingAnswers;return 0===b.answers.length?0===y.size(c)?a&&a():(a&&b.listen("waitSendCompleted",function(){0===b.answers.length+y.size(c)&&a()}),void 0):(b._sendErrorCount=b._sendErrorCount||0,b._sendTimer&&window.clearTimeout(b._sendTimer),b._sendTimer=window.setTimeout(function(){var d=b.answers.shift(),e=z.id(d.qid);c[e]=!0,I.submitQuestion({body:d,call:function(){delete c[e],b._sendErrorCount=0,b.sendAnswer(a),b.fire("waitSendCompleted")},error:function(f){delete c[e],b.answers.push(d),b._sendErrorCount++,b._sendErrorCount>=10?G.alert(f.msg,function(){b._sendErrorCount=0,b.sendAnswer(a)}):b.sendAnswer(a)}})},50),void 0)}function n(){var a=this,b=a.dones,c=[];return y.forEach(a.items,function(a,d){var e=z.id(a.qid);e&&e in b&&c.push(d)}),c}function o(a){var b=this,c=b.dones;return a=z.id(a),a&&c[a]?(c[a]||{}).usercontent:void 0}function p(){var a=this,b=a.getDonesIndex();return b.length>=a.items.length}function q(){var a=this;a._forbidRightMenu||(a._forbidRightMenu=!0,x(document).on("contextmenu",function(){return!!a.canUse.rightMenu}).on("click",function(b){3!==b.witch||a.canUse.rightMenu||b.preventDefault()}))}function r(){var a=this;a._forbidSelect||(a._forbidSelect=!0,x(document).on("selectstart",function(){return!!a.canUse.select})),x(document.body).css("-moz-user-select",a.canUse.select?"inherit":"none")}function s(a,b){function c(){return f&&8>=f&&e._forbidBlurWindFirst?(e._forbidBlurWindFirst=!1,void 0):(window.clearTimeout(e._blurTimer),e._blurTimer=window.setTimeout(function(){a&&a()},Q),void 0)}function d(){window.clearTimeout(e._blurTimer),b&&b()}var e=this;if(e._forbidBlurWind)return{blur:c,focus:d};e._forbidBlurWind=!0,e._forbidBlurWindFirst=!0;var f=B.ie();return x(window).blur(c),x(window).focus(d),{blur:c,focus:d}}function t(a){var b=this,c=b.timeDiffMap||{},d=b.manager,e=(new Date).getTime(),f=b._lastTimeId;if(a=z.id(a),window.clearTimeout(b._logDiffTimer),f&&c[f]){var g=Math.round((e-c[f])/1e3);d.addTimeDiff(f,g),delete c[f]}b._lastTimeId=null,b.timeDiffMap=c,a&&(c[a]=e,b._lastTimeId=a,b._logDiffTimer=window.setTimeout(function(){b.logTimeDiff(a)},1e3))}function u(a){var b=x("div.ft-wrap"),c=x("div.nk-main");a===!1?(b.show(),c.removeClass("fullscreen"),c.removeAttr("style"),x(document.body).removeClass("nk-body")):(b.hide(),c.addClass("fullscreen"),x(document.body).addClass("nk-body"))}function v(){var a=this,b=a.manager,c=C.loadMask("正在提交答案...");a.submitAnswer(),a.sendAnswer(function(){c.close(),a.currentIndex=null,a.currentExampleIndex=null,b.navMenu()})}function w(){var a=this,b=a.manager;a.submitAnswer();var c=a.isAllDone(),d=c?"提交后将无法再返回修改本题型做题结果，确定现在提交吗？":"你还有题目未完成，提交后将无法再返回修改本题型做题结果，确定现在提交吗？";G.confirm(d,function(){a.logTimeDiff();var c=C.loadMask("正在提交答案...");a.submitAnswer();var d=!!b.isLastType();d&&y.forEach(b.data.typeStatuses,function(b){2!==b.qstatus&&z.id(b.qtype)!==z.id(a.type)&&(d=!1)}),a.sendAnswer(function(){c.close(),a.currentIndex=null,a.currentExampleIndex=null,d&&b.finishPaper(!0),!d&&b.submitTest(a.type)})})}var x=a("../../../../lib/jquery"),y=a("../../../../lib/underscore"),z=a("../../../../util/util"),A=a("../../../../util/event"),B=a("../../../../util/browser"),C=a("../util/util"),D=a("../util/example");a("../../../../util/littleAction");var E=a("../../../../core/base"),F=a("../../../../core/component");a("../../../../component/checkgroup");var G=a("../../../../component/popup");a("../../../../util/upload");var H=a("../../../../core/siteConfig");a("../../../../action/code");var I=a("../../../../action/cts"),J=c.exports=E.createClass("site.cts.test.step.Exam"),K=H.questionType.danxuan,L=H.questionType.duoxuan,M=H.questionType.tiankong,N=H.questionType.biancheng,O=H.questionType.wenda,P=H.questionType.bigdata,Q=3e3;E.mix(J,F,{xtype:"Exam",_template:"<div></div>",listeners:[{name:"render",type:"custom",handler:function(){var a=this;a.getEl(),a.initEvent()}},{name:"entryStep",type:"custom",handler:function(a){var b=this,c=b.manager;a=a||z.id(b.type);var d=a===z.id(N)||a===z.id(P);b.canUse={rightMenu:!1,select:!1,blur:d},b.forbidRightMenu(),b.forbidSelect(),b.codeTheme(z.id(a)===z.id(N));var e=!1;b.forbidBlurWindowItem=b.forbidBlurWindow(function(){if(!b.canUse.blur&&!e){var a=(+c.data.leaveCount||0)+1;c.data.leaveCount=a,3>=a&&c.dataStatus.antiJumpOut&&(e=!0,G.alert("你已离开当前页面"+a+"次，除编程题外其他题型离开超过3次后将会标示作弊嫌疑。",function(){e=!1}));var d=b.getCurrentQuestion();I.addLeave({body:{uid:c.data.userId,tid:c.data.tid,qid:(d||{}).qid},call:function(a){(a.data||{}).leaveCount&&(c.data.leaveCount=a.data.leaveCount)}})}})}},{name:"leaveStep",type:"custom",handler:function(){var a=this;a.canUse={rightMenu:!0,select:!0,blur:!1},a.forbidSelect();var b=a.getQuestionModule(a.type);b&&b.fire("leaveStep"),b&&b.hide(),a.codeTheme(!1)}}]},{initialize:d,initEvent:e,loadQuestions:f,gotoQuestion:g,showQuestion:h,getCurrentQuestion:i,getQuestionModule:j,getTypeKey:k,submitAnswer:l,sendAnswer:m,getDonesIndex:n,getDoneContent:o,isAllDone:p,forbidRightMenu:q,forbidSelect:r,forbidBlurWindow:s,logTimeDiff:t,codeTheme:u,gotoMenu:v,clickSubmit:w})});

define("nowcoder/1.2.582/javascripts/site/cts/test/step/step0",["../../../../lib/jquery","../../../../lib/underscore","../../../../util/util","../../../../util/cookie","../../../../util/dom","../../../../util/browser","../util/util","../../../../util/event","../../../../util/stream","../../../../component/popup","../../../../core/base","../../../../core/component","../../../../component/layer","../../../../util/dragdrop","../../../../kit/webrtc/adapter","../util/oss","../../../../action/cts","../../../../util/ajax","../../../../core/siteConfig","../../../../component/input"],function(a,b,c){function d(a){var b=this;b.manager=a.manager;var c=(b.manager.data.paperSetting||{}).signUpFields,d=[],e=[];k.forEach(c,function(a){"true"===a.need||"true"===a.required?d["姓名"===a.title?"unshift":"push"](a):e.push(a)}),b.fields=d.concat(e),b.iptMap={};var f={};k.forEach(b.fields,function(a){f[a.name]=a}),s.superClass.initialize.call(b,a)}function e(){var a=this,b=a.getEl();k.forEach(b.find("div.js-field"),function(b){b=j(b);var c=b.attr("data-id");a.iptMap[c]=p.transform(b)})}function f(a){var b=this;if(!a||0===arguments.length){var c={};return k.forEach(b.fields,function(a){var d=b.iptMap[a.name];c[a.name]=j.trim(d.val())}),c}k.forEach(b.fields,function(c){var d=b.iptMap[c.name];d.val(j.trim(a[c.name]))})}function g(){var a=this;a.val();var b=!0;return k.forEach(a.fields,function(c){var d=a.iptMap[c.name],e=j.trim(d.val()),f="true"===c.need,g=c.title,h=!0;!e&&f?h=!1:!e||"Email"!==c.format&&-1===g.indexOf("邮箱")||l.isEmail(e)?!e||"Phone"!==c.format&&-1===g.indexOf("手机")||l.isPhone(e)?!e||"IDCard"!==c.format&&-1===g.indexOf("身份证")||l.isIdentity(e)||(h=!1):h=!1:h=!1,!h&&d.setErrorTips("请填写正确的"+g),b=b&&h}),b}function h(){var a=this,b=a.manager,c=b.data.user||{},d=!!b.data.userId,e=d?{}:l.getParams(),f="";return k.forEach(a.fields,function(a){var b=a.name,d="key"===b||"name"===b,g=j.trim(d?c[b]:(c.ext||{})[b]);f+=n.execTpl(['<div class="form-group">','<label class="control-label">#{title}</label>','<div class="control-group js-field" data-id="#{id}">','<input #{status} value="#{value}" type="text" placeholder="请输入#{title}" />',"</div>","</div>"].join(""),{title:a.title,value:g||e[b],id:b,status:d&&g?"disabled":""})}),f}function i(){var a=this,b=a.manager;return{header:m.getStepHeader(b.data,b.stepOrder,m.STEP_INFO),field:a.getFieldStr()}}var j=a("../../../../lib/jquery"),k=a("../../../../lib/underscore"),l=a("../../../../util/util");a("../../../../util/dom");var m=a("../util/util"),n=a("../../../../core/base"),o=a("../../../../component/popup"),p=a("../../../../component/input"),q=a("../../../../core/component"),r=a("../../../../action/cts"),s=c.exports=n.createClass("site.cts.test.step.examStep0");n.mix(s,q,{xtype:"examStep0",_template:['<div class="exam-cover">',"#{header}",'<div class="exam-confirm"></div>','<div class="exam-btn-wrap">','<a href="javascript:void(0);" class="btn btn-primary btn-auto js-next">下一步</a>',"</div>","</div>"].join(""),listeners:[{name:"render",type:"custom",handler:function(){var a=this;a.initComponent()}},{name:"entryStep",type:"custom",handler:function(){var a=this,b=a.getEl(),c=a.getFieldStr();b.find("div.exam-confirm").html(c),a.initComponent()}},{name:"click a.js-next",handler:function(){var a=this,b=a.manager;if(a.checkVal()){var c=b.data,d=a.val(),e={};k.forEach(d,function(a,b){"key"!==b&&"name"!==b&&(e[b]=a)});var f=m.loadMask("正在提交中...");r.validateUser({body:{id:c.userId,pid:c.paperId,key:d.key,name:d.name,ext:JSON.stringify(e)},call:function(b){var g=b.data||{},h=g.userId,i=l.getParam("id");if(!i&&h&&i!==h){var j=c.user;c.userId=h,j.id=h,j.key=d.key,j.name=d.name,j.ext=e}f.close(),a.fire("next")},error:function(a){f.close(),o.alert(a.msg)}})}}}]},{initialize:d,initComponent:e,val:f,checkVal:g,getFieldStr:h,_getData:i})});

define("nowcoder/1.2.582/javascripts/site/cts/test/step/step1",["../../../../lib/jquery","../../../../lib/underscore","../../../../util/util","../../../../util/cookie","../../../../util/event","../../../../util/limit","../../../../util/stream","../util/util","../../../../component/popup","../../../../core/base","../../../../core/component","../../../../component/layer","../../../../util/dragdrop","../../../../util/browser","../../../../kit/webrtc/adapter","../util/oss","../../../../action/cts","../../../../util/ajax","../../../../core/siteConfig"],function(a,b,c){function d(a){var b=this;b.manager=a.manager,b.status=w,b.camFixed=!1,v.superClass.initialize.call(b,a)}function e(){var a=this;n.listen(q.MSG_EVENT_GET_VIDEO_STREAM,function(b){b&&(q.getVideoEl(b,a.videoEl),a.camFixed=!0)})}function f(){var a=this,b=a.getEl(),c=b.find("div.js-video-container"),d=c.width(),e=3*d/4;a.videoEl.outerWidth(d).outerHeight(e),a.avatarEl.outerWidth(d).outerHeight(e),a.actionBtn.outerWidth(d),c.height(e+a.actionBtn.outerHeight()),m.forEach(["","moz","webkit","o","ms"],function(b){var c=b?b+"Transform":"transform";a.avatarEl.css(c,"scaleX(-1)")})}function g(){var a=this,b=a.manager,c=b.data.user,d=l.trim(c.headUrl);d&&a.showAvatar(c.headUrl),!d&&a.showVideo(),b.isSupportCam?a.getStream(function(c){c&&b.initCamera(),c&&q.getVideoEl(c,a.videoEl),a.camFixed=!!c}):t.alert("您的浏览器不支持摄像头功能，请更换最新版chrome浏览器，确保考试正常进行")}function h(){var a=this,b=a.manager;a.status=w,a.avatarEl.hide(),a.videoEl.show(),a.actionBtn.html('<i class="icon-camera">点击拍照</i>'),a.nextBtn.removeClass("btn-primary").addClass("btn-default"),!b.isSupportCam}function i(a){var b=this;b.status=x,b.videoEl.hide(),b.avatarEl.attr("src",a).show(),b.actionBtn.html('<i class="icon-camera">重新拍照</i>'),b.nextBtn.removeClass("btn-default").addClass("btn-primary")}function j(a){q.getVideoStream(function(b,c){(b||!c)&&q.popupPermission(),a&&a(c)})}function k(){var a=this,b=a.manager;return{header:q.getStepHeader(b.data,b.stepOrder,q.STEP_CAMERA)}}var l=a("../../../../lib/jquery"),m=a("../../../../lib/underscore");a("../../../../util/util");var n=a("../../../../util/event"),o=a("../../../../util/limit"),p=a("../../../../util/stream"),q=a("../util/util"),r=a("../../../../core/base"),s=a("../../../../core/component"),t=a("../../../../component/popup"),u=a("../../../../action/cts"),v=c.exports=r.createClass("site.cts.test.step.examStep1"),w="video",x="avatar";r.mix(v,s,{xtype:"examStep1",_template:['<div class="exam-cover">',"#{header}",'<div class="exam-confirm">','<p class="exam-tip"><i class="icon-exclamation-sign"></i>请点击视频画面下方的按钮进行拍照，考试过程中摄像头将全程开启，照片将用于和考场监控做对比</p>','<div class="video-mod">','<div class="video-img js-video-container">','<video class="js-video" style="display:block;"></video>','<img class="js-avatar" style="display:none;" src="//uploadfiles.nowcoder.com/images/20160520/56_1463728821615_B856A5CA00C64BEA1A77436F8FE39D5E" />','<div class="video-img-upload js-get-avatar"><i class="icon-camera">点击拍照</i></div>',"</div>","<dl>","<dt>拍照遇到问题怎么办？</dt>",'<dd>1、请检查你的电脑摄像头是否连接正常，浏览器的摄像头权限是否开启。<a class="link-green" href="/test/video" target="_blank">点此进行调试</a></dd>',"<dd>2、使用最新版本的Chorme或Firefox浏览器</dd>","<dd>3、还是有问题？请点右下角小窗联系我们</dd>","</dl>","</div>","</div>",'<div class="exam-btn-wrap">','<a href="javascript:void(0);" class="return-pre js-pre">&lt;&lt; 返回上一步</a>','<a href="javascript:void(0);" class="btn btn-primary btn-auto js-next">下一步</a>','<a href="javascript:void(0);" class="js-pass" style="position:absolute;line-height:36px;top:0;left:510px;">我没有摄像头，跳过这一步</a>',"</div>","</div>"].join(""),listeners:[{name:"render",type:"custom",handler:function(){var a=this,b=a.getEl();a.videoEl=b.find("video.js-video"),a.avatarEl=b.find("img.js-avatar"),a.actionBtn=b.find("div.js-get-avatar"),a.nextBtn=b.find("a.js-next"),a.passBtn=b.find("a.js-pass"),a.initEvent(),a.initAppear(),a.startVideo()}},{name:"click a.js-pre",handler:function(){var a=this;a.fire("pre")}},{name:"click a.js-next",handler:function(a){var b=this,c=l(a.currentTarget);return c.hasClass("btn-default")?(t.alert("请先点击拍照"),void 0):(b.fire("next"),void 0)}},{name:"click div.js-get-avatar",handler:function(a){function b(){e.headUrl="",c.startVideo(),t.alert("头像上传失败，请重试"),o.pause(f)}var c=this,d=c.manager.data,e=d.user,f=l(a.currentTarget),g=c.status;return o.mark(f)?void 0:g===x?(e.headUrl="",c.startVideo(),o.pause(f),void 0):(c.getStream(function(a){if(!a)return o.pause(f);var g=c.camFixed;c.camFixed=!0,!g&&q.getVideoEl(a,c.videoEl),c.actionBtn.html('<i class="icon-camera">拍照中...</i>'),window.setTimeout(function(){var a=p.getImageData(c.videoEl,480,360,"image/jpeg",.8);e.headUrl=a,c.startVideo(),q.uploadImageByImageData(a,d.userId,function(a){return a?(c.avatarEl.attr("src",a),u.uploadPic({body:{pid:d.paperId,tid:d.tid,uid:d.userId,url:a,isHead:!0},error:b,always:function(){o.pause(f)}}),void 0):b()})},g?0:2e3)}),void 0)}},{name:"click a.js-pass",handler:function(){var a=this;t.confirm("因拍照无法完成，你的成绩单上将没有头像，后台监控也会进行风险标识，可能会影响你的成绩，确定跳过吗？",function(){a.fire("next")})}}]},{initialize:d,initEvent:e,initAppear:f,startVideo:g,showVideo:h,showAvatar:i,getStream:j,_getData:k})});

define("nowcoder/1.2.582/javascripts/site/cts/test/step/step2",["../../../../lib/jquery","../../../../lib/underscore","../../../../util/util","../../../../util/cookie","../../../../util/limit","../../../../core/base","../../../../component/checkbox","../../../../core/component","../../../../util/event","../../../../component/popup","../../../../component/layer","../../../../util/dragdrop","../../../../util/browser","../../../../action/cts","../../../../util/ajax","../../../../core/siteConfig","../util/util","../../../../util/stream","../../../../kit/webrtc/adapter","../util/oss"],function(a,b,c){function d(a){var b=this;b.manager=a.manager,b.timeLeft=10,p.superClass.initialize.call(b,a)}function e(){var a=this;return a.timeLeft<=0?(a.nextEl.html("开始答题").removeClass("btn-default").addClass("btn-primary"),void 0):(window.clearTimeout(a.timer),a.timer=window.setTimeout(function(){a.timeLeft--,a.nextEl.html("开始答题("+a.timeLeft+")"),a.countDown()},1e3),void 0)}function f(){var a=this;window.clearTimeout(a.timer),a.timeLeft=10,a.nextEl.html("开始答题("+a.timeLeft+")")}function g(){var a=this,b=a.manager;return{header:o.getStepHeader(b.data,b.stepOrder,o.STEP_PROTOCOL),paperSummary:b.data.paperSetting.paperSummary.replace(/\n/gi,"<br />")}}var h=a("../../../../lib/jquery");a("../../../../lib/underscore"),a("../../../../util/util");var i=a("../../../../util/limit"),j=a("../../../../core/base"),k=a("../../../../component/checkbox"),l=a("../../../../component/popup"),m=a("../../../../action/cts"),n=a("../../../../core/component"),o=a("../util/util"),p=c.exports=j.createClass("site.cts.test.step.examStep2");j.mix(p,n,{xtype:"examStep2",_template:['<div class="exam-cover">',"#{header}",'<div class="exam-notice">','<div class="module-body">',"<h4>考试须知</h4>","<div>#{paperSummary}</div>","</div>",'<label class="checkbox">','<span class="icons"></span>我保证题目由个人独立完成，不在做题过程中获取来自网络、书籍、他人的帮助。',"</label>","</div>",'<div class="exam-btn-wrap">','<a href="javascript:void(0);" class="return-pre js-pre">&lt;&lt; 返回上一步</a>','<a href="javascript:void(0);" class="btn btn-default btn-auto js-next">开始答题(10)</a>',"</div>","</div>"].join(""),listeners:[{name:"render",type:"custom",handler:function(){var a=this,b=a.getEl();a.nextEl=b.find("a.js-next"),a.agreeChk=k.transform(b.find("label.checkbox")),a.countDown()}},{name:"entryStep",type:"custom",handler:function(){var a=this;a.stopCountDown(),a.countDown()}},{name:"leaveStep",type:"custom",handler:function(){var a=this;a.stopCountDown()}},{name:"click a.js-pre",handler:function(){var a=this;a.fire("pre")}},{name:"click a.js-next",handler:function(a){function b(){window.setTimeout(function(){return j--,0>=j?(o.closeMask(d),c()):(k.html("正在排队发卷中，请耐心等待"+j+"秒..."),b(),void 0)},1e3)}function c(){o.closeMask(d),d=o.loadMask("正在发卷中..."),m.beginTest({body:{uid:g.data.userId,pid:g.data.paperId},call:function(a){o.closeMask(d);var b=a.data;return b.isTestFinish?(window.location.reload(),void 0):(g.data.tid=b.tid,g.data.leftSeconds=+b.leftSeconds||0,g.data.typeStatuses=b.typeStatuses,g.data.leaveCount=+b.leaveCount||0,g.navAuto(),void 0)},error:function(a){o.closeMask(d),l.alert(a.msg),e._noQueueUp=!0},always:function(){i.clear(f)}})}var d,e=this,f=h(a.currentTarget),g=e.manager;if(!e.agreeChk.isChecked()||e.timeLeft>0)return l.alert("请阅读并同意考试须知"),void 0;if(!i.mark(f))if(g.dataStatus.noQueueUp||e._noQueueUp)c();else{var j=o.randomSecond(30),d=o.loadMask("正在排队发卷中，请耐心等待"+j+"秒..."),k=d.getEl().find("span.warning-word");b()}}}]},{initialize:d,countDown:e,stopCountDown:f,_getData:g})});

define("nowcoder/1.2.582/javascripts/site/cts/test/step/step3",["../../../../lib/jquery","../../../../lib/underscore","../../../../core/base","../../../../util/util","../../../../util/cookie","../../../../util/event","../util/util","../../../../util/stream","../../../../component/popup","../../../../core/component","../../../../component/layer","../../../../util/dragdrop","../../../../util/browser","../../../../kit/webrtc/adapter","../util/oss","../../../../action/cts","../../../../util/ajax","../../../../core/siteConfig"],function(a,b,c){function d(a){var b=this;b.manager=a.manager,q.superClass.initialize.call(b,a)}function e(){var a=this;a.manager,n.listen(o.MSG_EVENT_TIME_CHANGE,function(b){a.showTime(b)})}function f(a){var b=this;a=+a||0,b.timeEl.html(m.formTime(a))}function g(){var a=this,b=a.getEl(),c=a.manager,d=0,e=0;k.forEach(c.data.typeStatuses,function(a){d+=a.qcount,e+=2!==a.qstatus?a.fcount||0:a.qcount});var f=b.find("div.subject-progress");d=+d||0;var g=d?100*e/d:0;f.find("div.progress-bar").width(g+"%"),f.find("span.progress-nums").html(e+"/"+d)}function h(){var a=this,b=a.manager,c="",d={1:"单选题",2:"不定项选择题",3:"填空题",4:"编程题",5:"问答题",6:"数据挖掘"};return k.forEach(b.data.typeStatuses,function(a){var b=2!==a.qstatus;c+=l.execTpl('<a href="javascript:void(0);" class="btn #{cls} js-exam" data-type="#{type}">#{name}(#{count}题#{desc})</a>',{cls:b?"btn-primary":"btn-default",type:a.qtype,count:a.qcount,name:d[a.qtype+""]||"题目",desc:b?"":"，已提交"})}),c}function i(){var a=this,b=a.manager;return{list:a.getBtnStr(),display:b.dataStatus.antiJumpOut?"block":"none"}}var j=a("../../../../lib/jquery"),k=a("../../../../lib/underscore"),l=a("../../../../core/base"),m=a("../../../../util/util"),n=a("../../../../util/event"),o=a("../util/util"),p=a("../../../../core/component"),q=c.exports=l.createClass("site.cts.test.step.examStep3");l.mix(q,p,{xtype:"examStep3",_template:['<div class="module-box subject-box">','<div class="subject-progress">','<div class="progress">','<div style="width:0%" class="progress-bar"></div>',"</div>",'<span class="progress-nums">0/0</span>','<a href="javascript:void(0);" class="progress-time time-clock">','<i class="ico-time-control"></i>','<span class="time-text">00:00:00</span>',"</a>","</div>",'<div class="module-body">','<p class="exam-tip" style="display:#{display}"><i class="icon-exclamation-sign"></i><span>所有的客观题不允许跳出页面，跳出三次以上将后台记录。</span></p>','<div class="exam-btn-wrap">#{list}</div>',"</div>","</div>"].join(""),listeners:[{name:"render",type:"custom",handler:function(){var a=this,b=a.manager,c=a.getEl();b.dataStatus.allowCamera&&c.find("p.exam-tip span").html("考试过程中请将摄像头一直开启，以确认身份的真实性，并无线下作弊情况。"),a.timeEl=c.find("a.progress-time span.time-text"),a.initEvent()}},{name:"entryStep",type:"custom",handler:function(){var a=this,b=a.getEl();b.find("div.exam-btn-wrap").html(a.getBtnStr()),a.showProgress()}},{name:"click a.js-exam",handler:function(a){var b=this,c=b.manager,d=j(a.currentTarget),e=d.attr("data-type");c.navExam({type:e})}}]},{initialize:d,initEvent:e,showTime:f,showProgress:g,getBtnStr:h,_getData:i})});

define("nowcoder/1.2.582/javascripts/site/cts/test/exam/module",["../../../../lib/jquery","../../../../lib/underscore","../../../../util/util","../../../../util/cookie","../../../../util/browser","../util/util","../../../../util/event","../../../../util/stream","../../../../component/popup","../../../../core/base","../../../../core/component","../../../../component/layer","../../../../util/dragdrop","../../../../kit/webrtc/adapter","../util/oss","../../../../action/cts","../../../../util/ajax","../../../../core/siteConfig","../../../../util/littleAction","../../../../util/limit","../../../../util/dom","../../../../action/contest","../../../../action/note","../../../../util/highlighter","../../../../lib/syntaxhighlighter/shCore","../../../../lib/syntaxhighlighter/style/shCoreDefault.css","../../../../component/checkgroup","../../../../component/checkbox","../../../../util/upload","../../../../lib/swfupload","../../../../action/code"],function(a,b,c){function d(a){var b=this;b.manager=a.manager,b.module=a.module,t.superClass.initialize.call(b,a)}function e(a){var b=this;b.isExample=!!a}function f(a){var b=this;a=+a||0,b.timeEl.html(p.formTime(a))}function g(a,b,c,d){var e=this,f=d?'<span class="tag-label tag-test">例题</span>':"",g=p.id(c);f+=q.execTpl("[#{type}#{score}] #{name}",{type:a,score:g?"|"+g+"分":"",name:b},!0),e.titleEl.html(f)}function h(a,b,c,d){var e=this,f=e.getEl(),g=f.find("div.subject-progress"),h=d?0:(+a||0)+1;b=+b||0;var i=b?100*h/b:0;g.find("div.progress-bar").width(i+"%"),g.find("span.progress-nums").html(h+"/"+b);var j=f.find("ul.answer-sheet-num"),k=j.find("li a");k.removeClass("answering-num");var l=j.find("li[data-type="+(d?u:v)+"][data-index="+a+"] a");l.addClass("answering-num")}function i(a,b){var c=this,d=['<a href="javascript:void(0)" class="card-unfold">展开答题卡 <i class="icon-angle-down"></i></a>','<a href="javascript:void(0)" class="card-fold">收起答题卡 <i class="icon-angle-up"></i></a>','<ul class="answer-sheet-num clearfix">'].join("");o.forEach([b,a],function(a,b){for(var c=0===b,e=0;a>e;e++)d+=q.execTpl('<li data-type="#{type}" data-index="#{index}"><a href="javascript:void(0);">#{order}</a></li>',{type:c?u:v,index:e,order:c?"例"+(a>1?e+1:""):e+1})}),d+="</ul>",c.pagerEl.html(d)}function j(){var a=this,b=a.getEl(),c=b.find("ul.answer-sheet-num"),d=c.find("li a");d.removeClass("answer-done");var e=a.module.getDonesIndex();o.forEach(e,function(a){var b=c.find("li[data-type="+v+"][data-index="+a+"] a");b.hasClass("answering-num")||b.addClass("answer-done")})}function k(a,b,c,d){var e=this,f=e.getEl(),g=f.find("input.js-submit"),h=f.find("input.js-next"),i=!d&&a+1>=b,j=d&&a+1>=c;h.val(j?"开始答题":"下一题"),h[i?"hide":"show"](),g[i?"show":"hide"]();var k=e.manager;k.isLastType()?g.val(i?"交卷":"提前交卷"):g.val("提交本部分")}function l(){return""}function m(a){return[a?'<div class="subject-action clearfix">':"",'<div class="subject-next">','<input type="submit" class="btn warning-btn js-submit" value="提交本部分" />','<input type="submit" class="btn btn-primary js-next" value="下一题" />',"</div>",a?"</div>":""].join("")}var n=a("../../../../lib/jquery"),o=a("../../../../lib/underscore"),p=a("../../../../util/util");a("../../../../util/browser"),a("../util/util"),a("../../../../util/littleAction");var q=a("../../../../core/base"),r=a("../../../../core/component");a("../../../../component/checkgroup"),a("../../../../component/popup"),a("../../../../util/upload");var s=a("../../../../core/siteConfig");a("../../../../action/code"),a("../../../../action/cts");var t=c.exports=q.createClass("site.cts.test.exam.Module");s.questionType.danxuan,s.questionType.duoxuan,s.questionType.tiankong,s.questionType.biancheng,s.questionType.wenda,s.questionType.bigdata;var u="example",v="question";q.mix(t,r,{xtype:"ExamModule",_template:'<div style="font-size:14px;text-align:center;">看到这条信息表示出问题啦，赶快联系管理员~</div>',listeners:[{name:"render",type:"custom",handler:function(){var a=this,b=a.getEl();a.titleEl=b.find("div.subject-title"),a.timeEl=b.find("a.progress-time span.time-text"),a.contentEl=b.find(".js-question-main"),a.pagerEl=b.find("div.answer-sheet-box"),window.setTimeout(function(){var b=(a.manager||{}).chat;b&&b.fire("fixSize")},0)}},{name:"click a.card-unfold",handler:function(){var a=this;a.pagerEl.addClass("open"),a.fire("cardFold",!0)}},{name:"click a.card-fold",handler:function(){var a=this;a.pagerEl.removeClass("open"),a.fire("cardFold",!1)}},{name:"click ul.answer-sheet-num li",handler:function(a){var b=this,c=n(a.currentTarget),d=c.attr("data-type")===u,e=+c.attr("data-index")||0;b.fire("gotoQuestion",e,d)}},{name:"click input.js-next",handler:function(){var a=this;a.fire("gotoNext",!!a.isExample)}},{name:"click a.js-go-menu",handler:function(){var a=this;a.fire("gotoMenu")}},{name:"click input.js-submit",handler:function(){var a=this;a.fire("gotoSubmit")}}]},{initialize:d,showExample:e,showTime:f,showTitle:g,showProgress:h,showPager:i,showPagerDone:j,showNextAndSubmit:k,val:l,getActionStr:m})});

define("nowcoder/1.2.582/javascripts/site/cts/test/exam/type1",["../../../../lib/jquery","../../../../lib/underscore","../../../../core/base","../../../../component/checkgroup","../../../../util/event","../../../../util/util","../../../../util/cookie","../../../../component/checkbox","../../../../core/component","./module","../../../../util/browser","../util/util","../../../../util/stream","../../../../component/popup","../../../../component/layer","../../../../util/dragdrop","../../../../kit/webrtc/adapter","../util/oss","../../../../action/cts","../../../../util/ajax","../../../../core/siteConfig","../../../../util/littleAction","../../../../util/limit","../../../../util/dom","../../../../action/contest","../../../../action/note","../../../../util/highlighter","../../../../lib/syntaxhighlighter/shCore","../../../../lib/syntaxhighlighter/style/shCoreDefault.css","../../../../util/upload","../../../../lib/swfupload","../../../../action/code"],function(a,b,c){function d(){var a=this;k.superClass.initialize.apply(a,arguments)}function e(a,b,c){var d=this;d.getEl();var e=d.contentEl;d.showTitle("单选题",null,a.score,c);var f="";g.forEach(a.answers,function(a){f+=h.execTpl(['<a href="javascript:void(0);" class="subject-options" data-id="#{aid}">','<label class="radio">','<span class="icons"></span>','<input type="radio" value="#{aid}">',"<pre>#{content}</pre>","</label>","</a>"].join(""),a)});var j=['<div class="subject-content">','<div class="subject-question">',a.content||"","</div>",f,"</div>",d.getActionStr(!0)].join("");e.html(j);var k=d.chk=i.mix({el:e.find("a.subject-options label"),change:function(a){e.find("a.subject-options").removeClass("selected");var b=a.getEl();b.parent().addClass("selected")}});g.each(k.option,function(a){var b=a.getEl().parent();b.on("click",function(b){b.stopPropagation(),b.preventDefault(),a.fire("click")})}),b&&b.content&&k.val(b.content,!0)}function f(){var a=this;return a.chk.val()}a("../../../../lib/jquery");var g=a("../../../../lib/underscore"),h=a("../../../../core/base"),i=a("../../../../component/checkgroup"),j=a("./module"),k=c.exports=h.createClass("site.cts.test.exam.Type1");h.mix(k,j,{xtype:"ExamType1Module",_template:['<div class="module-box subject-box">','<div class="nowcoder-topic">','<div class="subject-progress">','<div class="progress">','<div style="width:0%" class="progress-bar"></div>',"</div>",'<span class="progress-nums">0/0</span>','<a href="javascript:void(0);" class="progress-time time-clock">','<i class="ico-time-control"></i>','<span class="time-text">00:00:00</span>',"</a>","</div>",'<div class="subject-title"></div>','<div class="subject-main js-question-main"></div>',"</div>",'<div class="answer-sheet-box open"></div>','<div class="subject-main"><a href="javascript:void(0);" class="js-go-menu">&lt;&lt;返回全部题型</a></div>',"</div>"].join("")},{initialize:d,showQuestion:e,val:f})});

define("nowcoder/1.2.582/javascripts/site/cts/test/exam/type2",["../../../../lib/jquery","../../../../lib/underscore","../../../../core/base","../../../../component/checkgroup","../../../../util/event","../../../../util/util","../../../../util/cookie","../../../../component/checkbox","../../../../core/component","./module","../../../../util/browser","../util/util","../../../../util/stream","../../../../component/popup","../../../../component/layer","../../../../util/dragdrop","../../../../kit/webrtc/adapter","../util/oss","../../../../action/cts","../../../../util/ajax","../../../../core/siteConfig","../../../../util/littleAction","../../../../util/limit","../../../../util/dom","../../../../action/contest","../../../../action/note","../../../../util/highlighter","../../../../lib/syntaxhighlighter/shCore","../../../../lib/syntaxhighlighter/style/shCoreDefault.css","../../../../util/upload","../../../../lib/swfupload","../../../../action/code"],function(a,b,c){function d(){var a=this;k.superClass.initialize.apply(a,arguments)}function e(a,b,c){var d=this,e=d.contentEl;d.showTitle("不定项选择题",null,a.score,c);var f="";g.forEach(a.answers,function(a){f+=h.execTpl(['<a href="javascript:void(0);" class="subject-options" data-id="#{aid}">','<label class="checkbox">','<span class="icons"></span>','<input type="checkbox" value="#{aid}">',"<pre>#{content}</pre>","</label>","</a>"].join(""),a)});var j=['<div class="subject-content">','<div class="subject-question">',a.content||"","</div>",f,"</div>",d.getActionStr(!0)].join("");d.contentEl.html(j);var k=d.chk=i.mix({el:e.find("a.subject-options label"),change:function(a){var b=a.getEl();b.parent()[a.isChecked()?"addClass":"removeClass"]("selected")}});if(g.each(k.option,function(a){var b=a.getEl().parent();b.on("click",function(b){b.stopPropagation(),b.preventDefault(),a.fire("click")})}),b&&b.content){var l=b.content.replace(/\s+/g,"").split(",");k.val(l,!0)}}function f(){var a=this;return(a.chk.val()||[]).join(",")}a("../../../../lib/jquery");var g=a("../../../../lib/underscore"),h=a("../../../../core/base"),i=a("../../../../component/checkgroup"),j=a("./module"),k=c.exports=h.createClass("site.cts.test.exam.Type2");h.mix(k,j,{xtype:"ExamType2Module",_template:['<div class="module-box subject-box">','<div class="nowcoder-topic">','<div class="subject-progress">','<div class="progress">','<div style="width:0%" class="progress-bar"></div>',"</div>",'<span class="progress-nums">0/0</span>','<a href="javascript:void(0);" class="progress-time time-clock">','<i class="ico-time-control"></i>','<span class="time-text">00:00:00</span>',"</a>","</div>",'<div class="subject-title"></div>','<div class="subject-main js-question-main"></div>',"</div>",'<div class="answer-sheet-box open"></div>','<div class="subject-main"><a href="javascript:void(0);" class="js-go-menu">&lt;&lt;返回全部题型</a></div>',"</div>"].join("")},{initialize:d,showQuestion:e,val:f})});

define("nowcoder/1.2.582/javascripts/site/cts/test/exam/type3",["../../../../lib/jquery","../../../../lib/underscore","../../../../core/base","./module","../../../../util/util","../../../../util/cookie","../../../../util/browser","../util/util","../../../../util/event","../../../../util/stream","../../../../component/popup","../../../../core/component","../../../../component/layer","../../../../util/dragdrop","../../../../kit/webrtc/adapter","../util/oss","../../../../action/cts","../../../../util/ajax","../../../../core/siteConfig","../../../../util/littleAction","../../../../util/limit","../../../../util/dom","../../../../action/contest","../../../../action/note","../../../../util/highlighter","../../../../lib/syntaxhighlighter/shCore","../../../../lib/syntaxhighlighter/style/shCoreDefault.css","../../../../component/checkgroup","../../../../component/checkbox","../../../../util/upload","../../../../lib/swfupload","../../../../action/code"],function(a,b,c){function d(){var a=this;k.superClass.initialize.apply(a,arguments)}function e(a,b,c){var d=this;d.showTitle("填空题",null,a.score,c),b=b||{};var e=(b.content||"").split("[$##$]"),f="",g="",i=(a.contents||[]).length;h.forEach(a.contents,function(a,b){f+=a,i>b+1&&(f+='<span class="blank-num">'+(b+1)+"</span>",g+=['<div class="blank-answer">','<span class="blank-num">'+(b+1)+"</span>",'<input value="'+(e[b]||"")+'" placeholder="请在此填写答案" class="blank-content" type="text">',"</div>"].join(""))});var j=['<div class="subject-content">','<div class="subject-question">',f,"</div>",g,"</div>",d.getActionStr(!0)].join("");d.contentEl.html(j)}function f(){var a=this,b=a.contentEl.find("input.blank-content"),c=h.map(b,function(a){return g.trim(g(a).val())});return c.join("[$##$]")}var g=a("../../../../lib/jquery"),h=a("../../../../lib/underscore"),i=a("../../../../core/base"),j=a("./module"),k=c.exports=i.createClass("site.cts.test.exam.Type3");i.mix(k,j,{xtype:"ExamType3Module",_template:['<div class="module-box subject-box">','<div class="nowcoder-topic">','<div class="subject-progress">','<div class="progress">','<div style="width:0%" class="progress-bar"></div>',"</div>",'<span class="progress-nums">0/0</span>','<a href="javascript:void(0);" class="progress-time time-clock">','<i class="ico-time-control"></i>','<span class="time-text">00:00:00</span>',"</a>","</div>",'<div class="subject-title"></div>','<div class="subject-main js-question-main"></div>',"</div>",'<div class="answer-sheet-box open"></div>','<div class="subject-main"><a href="javascript:void(0);" class="js-go-menu">&lt;&lt;返回全部题型</a></div>',"</div>"].join("")},{initialize:d,showQuestion:e,val:f})});

define("nowcoder/1.2.582/javascripts/site/cts/test/exam/type4",["../../../../lib/jquery","../../../../lib/underscore","../../../../core/base","../../../../util/util","../../../../util/cookie","../../../../util/littleAction","../../../../util/limit","../../../../util/dom","../../../../util/browser","../../../../action/contest","../../../../util/ajax","../../../../core/siteConfig","../../../../action/note","../../../../component/popup","../../../../core/component","../../../../util/event","../../../../component/layer","../../../../util/dragdrop","../../../../util/highlighter","../../../../lib/syntaxhighlighter/shCore","../../../../lib/syntaxhighlighter/style/shCoreDefault.css","./module","../util/util","../../../../util/stream","../../../../kit/webrtc/adapter","../util/oss","../../../../action/cts","../../../../component/checkgroup","../../../../component/checkbox","../../../../util/upload","../../../../lib/swfupload","../../../../action/code"],function(a,b,c){function d(){var a=this;a.codeEditorMap={},s.superClass.initialize.apply(a,arguments)}function e(){var a=this;a.unReisze(),a.resize();var b;a.resizeCb=a.resizeCb||function(){window.clearTimeout(b),b=window.setTimeout(n.bind(a.resize,a),0)},m(window).on("resize",a.resizeCb)}function f(){var a=this;a.resizeCb&&m(window).unbind("resize",a.resizeCb)}function g(b,c,d){var e=this,f=e.getEl(),g=e.manager,h=e.module,i=p.id(b.qid);g.chat&&g.chat.stopFixBottom(),e.initResize(!0),e.showTitle("编程题",b.title,b.score,d);var j=b.ext,k=f.find("div.question-intr"),l=[];d?(l.push("例题说明："),l.push("1、本题目为例题，不计分。"),l.push("2、在代码框中选择你擅长的语言，标准的输入输出代码将显示在代码框中，请作为参考。"),l.push("3、本次考试正式编程题均将遵循此输入输出规范，如已掌握规范请跳过此题，点击屏幕右下方“开始答题”按钮进入正式考题。"),l.push("4、在完成正式编程考题前，如果输入输出格式遇到问题，你可通过答题卡随时切换回本例题进行参考。")):("timeLimit"in j&&l.push("时间限制："+(j.timeLimit||1)+"秒"),"memoryLimit"in j&&l.push("空间限制："+j.memoryLimit+"K")),k.html(l.join("<br />")),k[l.length>0?"show":"hide"]();var n=['<div class="subject-question">',b.content,j.inputDesc?"</br><h5><b>输入描述:</b></h5><pre>"+j.inputDesc+"</pre></br>":"",j.outputDesc?"</br><h5><b>输出描述:</b></h5><pre>"+j.outputDesc+"</pre>":"",j.inputSample?"</br><h5><b>输入例子:</b></h5><pre>"+j.inputSample+"</pre>":"",j.outputSample?"</br><h5><b>输出例子:</b></h5><pre>"+j.outputSample+"</pre>":"","</div>"].join("");e.contentEl.html(n);var o=f.find("div.coding-main"),r="jsCodeContainer"+i,s=o.find("#"+r),t=s.length>0;e.currentContainerId=r,t||(s=m(['<div class="js-code-container" id="',r,'">','<div class="subject-content js-right-top" style="overflow:hidden">','<div class="js-code-editor"></div>','<a href="javascript:void(0);" class="icon-angle-down js-toggle-angle"></a>',"</div>",'<div class="js-right-center subject-action clearfix" style="margin:0;">',d?"":'<button class="btn btn-blue btn-large btn-block js-run">提交运行</button>',e.getActionStr(),"</div>",'<div class="passed-wrapper js-right-bottom" style="margin:0;padding:5px 10px;overflow:hidden;display:none;">','<div class="js-run-info" style="margin:0;overflow-y:auto;color:#00bc9b;">提交运行之后，这里将会显示运行结果</div>',"</div>","</div>"].join("")),o.append(s),"2"===p.id(j.codingType)?a.async("../../../../component/editorSub/codeEditor",function(){a.async("../../../../component/editorSub/codeFEEditor",function(a){var d=q.initFECodeEditor(a,{noAutoSize:!0,pid:g.data.paperId,tid:g.data.tid,qid:b.qid,supportLang:j.supportLang,htmlTpl:e.getTextarea(j.cppTemplate),cssTpl:e.getTextarea(j.cTemplate),jsTpl:e.getTextarea(j.javaTemplate),codeEl:s.find(".js-code-editor"),runInfoEl:s.find(".js-run-info"),runCodeEl:s.find(".js-run")});try{var f=c?JSON.parse(c.content):null;f&&d.resetCode(f)}catch(k){}e.codeEditorMap[r]=d,e.fixCodeEditor(d,r),d.listen("runCodeFinish",function(){h.dones[i]={qid:b.qid,usercontent:{content:d.getJsonStr()}}})})}):a.async("../../../../component/editorSub/codeEditor",function(a){var d=j.codingType,f=q.initCodeEditor(a,{noAutoSize:!0,noCacheCode:!0,pid:g.data.paperId,tid:g.data.tid,qid:b.qid,codeJudgeType:d,submitCode:c?{code:c.content,language:c.language}:null,cTpl:e.getTextarea(j.cppTemplate),javaTpl:e.getTextarea(j.javaTemplate),pythonTpl:"0"===d||"1"===d&&j.pythonTemplate?e.getTextarea(j.pythonTemplate):null,cSharpTpl:"0"===d||"1"===d&&j.csharpTemplate?e.getTextarea(j.csharpTemplate):null,jsTpl:"0"===d||"1"===d&&j.jsTemplate?e.getTextarea(j.jsTemplate):null,codeEl:s.find(".js-code-editor"),runInfoEl:s.find(".js-run-info"),runCodeEl:s.find(".js-run")});e.codeEditorMap[r]=f,e.fixCodeEditor(f,r),f.listen("runCodeFinish",function(){h.dones[i]={qid:b.qid,usercontent:{content:f.valCode(),language:f.valLangue()}}})})),o.find("div.js-code-container").hide(),s.show(),t&&e.resizeRight(r)}function h(a,b){var c=this;if(a){var d=c.getEl(),e=d.find("#"+a),f=e.find("div.subject-content"),g=f.hasClass("open");g&&b!==!1||!g&&b===!1||(f[b===!1?"removeClass":"addClass"]("open"),c.resizeRight(a))}}function i(a){var b=this,c=b.getEl(),d=m(window),e=m("div.nk-main"),f=c.find("div.js-left-part"),g=c.find("div.coding-main"),h=c.find("div.subject-progress");e.outerWidth(d.width()).outerHeight(d.height());var i=e.width(),j=e.height()-h.outerHeight(),k=.35*i;f.outerHeight(j),f.outerWidth(k);var l=f.find("div.js-left-top"),n=f.find("div.js-left-bottom");n.height("auto"),l.outerHeight(j-n.outerHeight()),g.outerHeight(j),g.css("marginLeft",k);var o=b.currentContainerId;!a&&o&&b.resizeRight(o)}function j(a){var b=this,c=b.getEl();if(a){var d=c.find("#"+a),e=b.codeEditorMap[a];if(!e||!e.isFullScreen){var f=c.find("div.coding-main"),g=d.find("div.js-right-top"),h=d.find("div.js-right-center"),i=d.find("div.js-right-bottom"),j=g.hasClass("open"),k=f.height(),l=h.outerHeight(),m=j?Math.max(.2*k,60):0;g.outerHeight(k-m-l),i.outerHeight(m)[j?"show":"hide"](),i.find("div.js-run-info").outerHeight(i.height());var n=g.find("a.icon-angle-down").outerHeight(),o=Math.max(100,g.height()-n);e&&e.setSize(null,o);var p=b.manager,q=p.chat;if(q){var r=m+l+n;q.getEl().css("bottom",r),q.holderEl.css("bottom",r)}}}}function k(a){return m("<textarea>"+(a||"")+"</textarea>")}function l(a,b){var c=this;a&&b&&(a.showResult=function(a,b){var c=this,d=c.rawConfig,e=d.tipEl;if(a=m.trim(a),!a)return e.html("").hide();e.css("color",b===!0?"#b6b79a":"#00bc9b");var f=b===!1?'<div class="ico-passed">通过</div>':b===!0?'<div class="ico-unpass">不通过</div>':"";f+="<div>"+a.replace(/\n/g,"<br />")+"</div>",e.html(f)},a.listen("beforeRunCode",function(){c.openTab(b)}),a.listen("fullScreen",function(a){!a&&c.resizeRight(b)}),c.resizeRight(b))}var m=a("../../../../lib/jquery"),n=a("../../../../lib/underscore"),o=a("../../../../core/base"),p=a("../../../../util/util"),q=a("../../../../util/littleAction"),r=a("./module"),s=c.exports=o.createClass("site.cts.test.exam.Type4");o.mix(s,r,{xtype:"ExamType4Module",_template:["<div>",'<div class="subject-progress">','<div class="progress">','<div style="width:0%" class="progress-bar"></div>',"</div>",'<span class="progress-nums">0/0</span>','<a href="javascript:void(0);" class="progress-time time-clock">','<i class="ico-time-control"></i>','<span class="time-text">00:00:00</span>',"</a>","</div>",'<div class="js-left-part coding-side-bar" style="overflow:hidden;padding:0 10px;">','<div class="js-left-top" style="overflow-y:auto;">','<div class="subject-title test-title"></div>','<div class="question-intr"></div>','<div class="module-box subject-box">','<div class="module-head clearfix"><h1>题目描述</h1></div>','<div class="subject-main"><div class="subject-content js-question-main"></div></div>',"</div>","</div>",'<div class="js-left-bottom clearfix" style="padding-top:10px;">','<div class="answer-sheet-box open"></div>','<div class="subject-main" style="padding:10px;"><a href="javascript:void(0);" class="js-go-menu">&lt;&lt;返回全部题型</a></div>',"</div>","</div>",'<div class="coding-main" style="overflow:hidden;padding-bottom:0;margin-bottom:0;"></div>',"</div>"].join(""),listeners:[{name:"leaveStep",type:"custom",handler:function(){var a=this,b=a.manager;a.currentContainerId=null,a.unReisze(),b.chat&&b.chat.stopFixBottom(!1)}},{name:"cardFold",type:"custom",handler:function(){var a=this;a.resize()}},{name:"click a.js-toggle-angle",handler:function(a){var b=this,c=m(a.currentTarget),d=c.closest("div.js-code-container"),e=d.find("div.subject-content"),f=e.hasClass("open");b.openTab(d.attr("id"),!f)}}]},{initialize:d,initResize:e,unReisze:f,showQuestion:g,openTab:h,resize:i,resizeRight:j,getTextarea:k,fixCodeEditor:l})});

define("nowcoder/1.2.582/javascripts/site/cts/test/exam/type5",["../../../../lib/jquery","../../../../lib/underscore","../../../../core/base","../../../../util/dom","../../../../util/browser","../../../../util/util","../../../../util/cookie","../../../../core/siteConfig","../../../../component/popupSub/popupScanUpload","../../../../core/component","../../../../util/event","../../../../component/popup","../../../../component/layer","../../../../util/dragdrop","../../../../action/common","../../../../util/ajax","./module","../util/util","../../../../util/stream","../../../../kit/webrtc/adapter","../util/oss","../../../../action/cts","../../../../util/littleAction","../../../../util/limit","../../../../action/contest","../../../../action/note","../../../../util/highlighter","../../../../lib/syntaxhighlighter/shCore","../../../../lib/syntaxhighlighter/style/shCoreDefault.css","../../../../component/checkgroup","../../../../component/checkbox","../../../../util/upload","../../../../lib/swfupload","../../../../action/code"],function(a,b,c){function d(){var a=this;a.editorCb=[],p.superClass.initialize.apply(a,arguments)}function e(b){var c=this;if(c.txtEditor)return b&&b(c.txtEditor);if(c.editorCb.push(b),!(c.editorCb.length>1)){var d=c.getEl(),e=c.module,f=c.manager;a.async("../../../../component/editorSub/hEditor",function(a){var b=null;c.txtEditor=new a({renderTo:d.find("textarea.subject-anwser-wd"),renderBy:"replaceWith",noUploadRemote:!0,content:"",height:250,toolbarFixedTop:l.getNavHeight(),keConf:{uploadJson:"/cts/file/upload",extraFileUploadParams:{uid:f.data.userId,type:m.uploadType.data}},afterFocus:function(){b&&window.clearTimeout(b),b=window.setTimeout(function(){e.forbidBlurWindowItem&&e.forbidBlurWindowItem.focus()},0)},afterBlur:function(){b&&window.clearTimeout(b),e.forbidBlurWindowItem&&e.forbidBlurWindowItem.blur()}}),j.forEach(c.editorCb,function(a){a&&a(c.txtEditor)}),c.editorCb.length=0})}}function f(a,b,c){var d=this;d.currentData=a,d.showTitle("问答题",null,a.score,c);var e=['<h2 class="subject-item-title">题目描述</h2>','<div class="subject-question">',a.content,"</div>",'<div class="subject-anwser-tip">如需画图或推导，你可以在草稿纸上作答，手机拍照后<a href="javascript:void(0)" class="link-green js-upload-tips">点此扫码上传</a></div>'].join("");d.contentEl.html(e),d.initEditor(function(a){var c=b&&b.content?b.content:"";a.val(c)})}function g(){var a=this;return a.txtEditor.val()}function h(){var a=this;return{action:a.getActionStr(!0)}}var i=a("../../../../lib/jquery"),j=a("../../../../lib/underscore"),k=a("../../../../core/base"),l=a("../../../../util/dom"),m=a("../../../../core/siteConfig"),n=a("../../../../component/popupSub/popupScanUpload"),o=a("./module"),p=c.exports=k.createClass("site.cts.test.exam.Type5");k.mix(p,o,{xtype:"ExamType5Module",_template:['<div class="module-box subject-box">','<div class="nowcoder-topic">','<div class="subject-progress">','<div class="progress">','<div style="width:0%" class="progress-bar"></div>',"</div>",'<span class="progress-nums">0/0</span>','<a href="javascript:void(0);" class="progress-time time-clock">','<i class="ico-time-control"></i>','<span class="time-text">00:00:00</span>',"</a>","</div>",'<div class="subject-title"></div>','<div class="subject-main nowcoder-topic-body js-question-main"></div>',"</div>",'<div class="nowcoder-topic-answer subject-des" style="margin-bottom:0;margin-top:0;padding-top:0;">','<div class="editor-box"><textarea class="subject-anwser-wd"></textarea></div>',"#{action}","</div>",'<div class="answer-sheet-box open"></div>','<div class="subject-main"><a href="javascript:void(0);" class="js-go-menu">&lt;&lt;返回全部题型</a></div>',"</div>"].join(""),listeners:[{name:"click a.js-upload-tips",handler:function(){var a=this,b=a.manager,c=a.currentData;n.show({data:{syncType:m.syncType.ctsTest,uid:b.data.userId,entityId:c.qid,ownerId:b.data.tid},call:function(b){var c=a.txtEditor;b=i.trim(b),c&&b&&c.waitCreated(function(){try{c.getEditor().exec("insertimage",b)}catch(a){}})}})}}]},{initialize:d,initEditor:e,showQuestion:f,val:g,_getData:h})});

define("nowcoder/1.2.582/javascripts/site/cts/test/exam/type6",["../../../../lib/jquery","../../../../lib/underscore","../../../../core/base","../../../../core/siteConfig","../../../../util/util","../../../../util/cookie","../../../../util/upload","../../../../lib/swfupload","../../../../component/popup","../../../../core/component","../../../../util/event","../../../../component/layer","../../../../util/dragdrop","../../../../util/browser","../../../../component/checkgroup","../../../../component/checkbox","../../../../action/code","../../../../util/ajax","./module","../util/util","../../../../util/stream","../../../../kit/webrtc/adapter","../util/oss","../../../../action/cts","../../../../util/littleAction","../../../../util/limit","../../../../util/dom","../../../../action/contest","../../../../action/note","../../../../util/highlighter","../../../../lib/syntaxhighlighter/shCore","../../../../lib/syntaxhighlighter/style/shCoreDefault.css"],function(a,b,c){function d(){var a=this;a.dmMap={},p.superClass.initialize.apply(a,arguments)}function e(a,b,c){var d=this,e=d.getEl(),f=d.dmMap,g=l.id(a.qid);d.dmActionEl=d.dmActionEl||e.find("div.js-dm-container"),i.forEach(f,function(a){a&&a.key!==g&&a.hide()}),f[g]||(f[g]=d.getItem(g,a,b,c)),f[g].show()}function f(a,b,c,d){function e(){new m({target:h,url:"/cts/file/upload",postParam:{uid:j.data.userId,type:k.uploadType.data},holderEl:r.action.find("a.js-subject-upload"),type:k.uploadType.data,fileType:"*.txt",fileQueueLimit:1,btn:{image:"/images/img/subject-upload-btn2.png",width:150,height:45},uploadSuccess:function(a,b){q=b.url,t.find(".subject-upload-text").html("已上传: "+b.fileName),f(b.url)}})}function f(a){n.submitDmInPaper({body:{pid:j.data.paperId,tid:j.data.tid,qid:b.qid,url:a},call:function(c){o.dones[l.id(b.qid)]={qid:b.qid,usercontent:{urls:a}},window.clearTimeout(v),v=setTimeout(function(){var a=arguments.callee;n.newDmStatus({query:{submissionId:c.submissionId},call:function(b){b=b||{};var c=b.status;if(5===c){var d=b.desc+"<br />"+b.memo;g(d,"info"),v=null}else{if(0===c||23===c||19===c||100===c){v=setTimeout(a,500);var d=b.desc+"<br />"+b.memo;return g(d,"info"),void 0}var d=b.desc+"<br />"+b.memo;g(d),v=null}},error:function(){g("出现错误，请重试")}})},500)},error:function(){g("出现错误，请重试")}})}function g(a,b){var c=t.find(".js-dm-subject-info"),d="info"===b;c.removeClass(d?"alert-danger":"alert-info").addClass(d?"alert-info":"alert-danger"),c.html(a.replace(/\n/g,"<br />")).show(),c.parent().show()}var h=this,i=h.getEl();i.find("div.nowcoder-topic-answer");var j=h.manager,o=h.module;h.showTitle("数据挖掘",null,b.score,d),c&&c.content?c.content:"";var p=((c||{}).urls||"").split(",")[0]||"",q=p||null,r=h.getItemDom(b,c),s=r.content,t=r.action,u=!0;return{key:a,show:function(){u&&(u=!1,h.contentEl.append(s),h.dmActionEl.append(t),e()),s.show(),t.removeClass("exercise-hide")},hide:function(){s.hide(),t.addClass("exercise-hide")}};var v}function g(a,b){var c=this,d=a.ext||{},e=j.execTpl(["<div>",'<h2 class="subject-item-title">题目描述</h2>','<div class="subject-question">#{content}</div>','<h2 class="subject-item-title">数据获取</h2>','<div class="subject-upload">','<div class="subject-des">#{fileDescription}</div>','<div class="subject-upload-inner clearfix">','<span class="down-file-name">mnist_train_test.zip</span>','<div class="down-files-btnbox">','<a data-prevent="0" class="btn btn-primary down-files" target="_blank" href="#{fileDownload2}">普通下载</a>','<a data-prevent="0" class="btn btn-primary down-files" target="_blank" href="#{fileDownload1}">高速下载</a>',"</div>","</div>","</div>","</div>"].join(""),{content:a.content,fileDescription:d.fileDescription,fileDownload2:d.fileDownload2,fileDownload1:d.fileDownload1}),f=((b||{}).urls||"").split(",")[0]||"",g=f?"已上传: "+l.getFileName(f):"上传数据结果文件,格式仅限txt文件",i=["<div>",'<div class="subject-upload">','<div class="subject-upload-inner">','<a class="btn-upload2 js-subject-upload" href="javascript:void(0);"></a>','<span class="subject-upload-text">',g,"</span>","</div>","</div>",'<div class="subject-info">','<div class="alert alert-danger js-dm-subject-info" style="display:none;"></div>',"</div>",c.getActionStr(!0),"</div>"].join("");return{content:h(e),action:h(i)}}var h=a("../../../../lib/jquery"),i=a("../../../../lib/underscore"),j=a("../../../../core/base"),k=a("../../../../core/siteConfig"),l=a("../../../../util/util"),m=a("../../../../util/upload");a("../../../../component/checkgroup");var n=a("../../../../action/code"),o=a("./module"),p=c.exports=j.createClass("site.cts.test.exam.Type6");j.mix(p,o,{xtype:"ExamType6Module",_template:['<div class="module-box subject-box">','<div class="nowcoder-topic">','<div class="subject-progress">','<div class="progress">','<div style="width:0%" class="progress-bar"></div>',"</div>",'<span class="progress-nums">0/0</span>','<a href="javascript:void(0);" class="progress-time time-clock">','<i class="ico-time-control"></i>','<span class="time-text">00:00:00</span>',"</a>","</div>",'<div class="subject-title"></div>','<div class="subject-main nowcoder-topic-body js-question-main"></div>',"</div>",'<div class="nowcoder-topic-answer subject-des js-dm-container" style="margin-bottom:0;margin-top:0;padding-top:0;"></div>','<div class="answer-sheet-box open"></div>','<div class="subject-main"><a href="javascript:void(0);" class="js-go-menu">&lt;&lt;返回全部题型</a></div>',"</div>"].join(""),listeners:[{name:"leaveStep",type:"custom",handler:function(){var a=this;i.forEach(a.dmMap,function(a){a&&a.hide()})}}]},{initialize:d,showQuestion:e,getItem:f,getItemDom:g})});

define("nowcoder/1.2.582/javascripts/kit/webrtc/adapter",[],function(a,b,c){function d(a){return new Promise(function(b,c){e(a,b,c)})}var e=null,f=null,g=null,h=null,i=null,j=null,k={log:function(){"undefined"!=typeof c||"function"==typeof a&&"function"==typeof define||console.log.apply(console,arguments)},extractVersion:function(a,b,c){var d=a.match(b);return d&&d.length>=c&&parseInt(d[c],10)}};if("object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return"mozSrcObject"in this?this.mozSrcObject:this._srcObject},set:function(a){"mozSrcObject"in this?this.mozSrcObject=a:(this._srcObject=a,this.src=URL.createObjectURL(a))}}),e=window.navigator&&window.navigator.getUserMedia),f=function(a,b){a.srcObject=b},g=function(a,b){a.srcObject=b.srcObject},"undefined"!=typeof window&&window.navigator)if(navigator.mozGetUserMedia){if(k.log("This appears to be Firefox"),h="firefox",i=k.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1),j=31,window.RTCPeerConnection||(window.RTCPeerConnection=function(a,b){if(38>i&&a&&a.iceServers){for(var c=[],d=0;d<a.iceServers.length;d++){var e=a.iceServers[d];if(e.hasOwnProperty("urls"))for(var f=0;f<e.urls.length;f++){var g={url:e.urls[f]};0===e.urls[f].indexOf("turn")&&(g.username=e.username,g.credential=e.credential),c.push(g)}else c.push(a.iceServers[d])}a.iceServers=c}return new mozRTCPeerConnection(a,b)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return arguments.length?mozRTCPeerConnection.generateCertificate.apply(null,arguments):mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),e=function(a,b,c){var d=function(a){if("object"!=typeof a||a.require)return a;var b=[];return Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var d=a[c]="object"==typeof a[c]?a[c]:{ideal:a[c]};if((void 0!==d.min||void 0!==d.max||void 0!==d.exact)&&b.push(c),void 0!==d.exact&&("number"==typeof d.exact?d.min=d.max=d.exact:a[c]=d.exact,delete d.exact),void 0!==d.ideal){a.advanced=a.advanced||[];var e={};e[c]="number"==typeof d.ideal?{min:d.ideal,max:d.ideal}:d.ideal,a.advanced.push(e),delete d.ideal,Object.keys(d).length||delete a[c]}}}),b.length&&(a.require=b),a};return 38>i&&(k.log("spec: "+JSON.stringify(a)),a.audio&&(a.audio=d(a.audio)),a.video&&(a.video=d(a.video)),k.log("ff37: "+JSON.stringify(a))),navigator.mozGetUserMedia(a,b,c)},navigator.getUserMedia=e,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:d,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(a){var b=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];a(b)})},41>i){var l=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return l().then(void 0,function(a){if("NotFoundError"===a.name)return[];throw a})}}}else if(navigator.webkitGetUserMedia&&window.webkitRTCPeerConnection){k.log("This appears to be Chrome"),h="chrome",i=k.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2),j=38,window.RTCPeerConnection=function(a,b){a&&a.iceTransportPolicy&&(a.iceTransports=a.iceTransportPolicy);var c=new webkitRTCPeerConnection(a,b),d=c.getStats.bind(c);return c.getStats=function(a,b){var c=this,e=arguments;if(arguments.length>0&&"function"==typeof a)return d(a,b);var f=function(a){var b={},c=a.result();return c.forEach(function(a){var c={id:a.id,timestamp:a.timestamp,type:a.type};a.names().forEach(function(b){c[b]=a.stat(b)}),b[c.id]=c}),b};if(arguments.length>=2){var g=function(a){e[1](f(a))};return d.apply(this,[g,arguments[0]])}return new Promise(function(b,g){1===e.length&&null===a?d.apply(c,[function(a){b.apply(null,[f(a)])},g]):d.apply(c,[b,g])})},c},window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype,webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return arguments.length?webkitRTCPeerConnection.generateCertificate.apply(null,arguments):webkitRTCPeerConnection.generateCertificate}}),["createOffer","createAnswer"].forEach(function(a){var b=webkitRTCPeerConnection.prototype[a];webkitRTCPeerConnection.prototype[a]=function(){var a=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var c=1===arguments.length?arguments[0]:void 0;return new Promise(function(d,e){b.apply(a,[d,e,c])})}return b.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){var b=webkitRTCPeerConnection.prototype[a];webkitRTCPeerConnection.prototype[a]=function(){var a=arguments,c=this;return new Promise(function(d,e){b.apply(c,[a[0],function(){d(),a.length>=2&&a[1].apply(null,[])},function(b){e(b),a.length>=3&&a[2].apply(null,[b])}])})}});var m=function(a){if("object"!=typeof a||a.mandatory||a.optional)return a;var b={};return Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var d="object"==typeof a[c]?a[c]:{ideal:a[c]};void 0!==d.exact&&"number"==typeof d.exact&&(d.min=d.max=d.exact);var e=function(a,b){return a?a+b.charAt(0).toUpperCase()+b.slice(1):"deviceId"===b?"sourceId":b};if(void 0!==d.ideal){b.optional=b.optional||[];var f={};"number"==typeof d.ideal?(f[e("min",c)]=d.ideal,b.optional.push(f),f={},f[e("max",c)]=d.ideal,b.optional.push(f)):(f[e("",c)]=d.ideal,b.optional.push(f))}void 0!==d.exact&&"number"!=typeof d.exact?(b.mandatory=b.mandatory||{},b.mandatory[e("",c)]=d.exact):["min","max"].forEach(function(a){void 0!==d[a]&&(b.mandatory=b.mandatory||{},b.mandatory[e(a,c)]=d[a])})}}),a.advanced&&(b.optional=(b.optional||[]).concat(a.advanced)),b};if(e=function(a,b,c){return a.audio&&(a.audio=m(a.audio)),a.video&&(a.video=m(a.video)),k.log("chrome: "+JSON.stringify(a)),navigator.webkitGetUserMedia(a,b,c)},navigator.getUserMedia=e,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:d,enumerateDevices:function(){return new Promise(function(a){var b={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(c){a(c.map(function(a){return{label:a.label,kind:b[a.kind],deviceId:a.id,groupId:""}}))})})}}),navigator.mediaDevices.getUserMedia){var n=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(a){return k.log("spec:   "+JSON.stringify(a)),a.audio=m(a.audio),a.video=m(a.video),k.log("chrome: "+JSON.stringify(a)),n(a)}}else navigator.mediaDevices.getUserMedia=function(a){return d(a)};"undefined"==typeof navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){k.log("Dummy mediaDevices.addEventListener called.")}),"undefined"==typeof navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){k.log("Dummy mediaDevices.removeEventListener called.")}),f=function(a,b){i>=43?a.srcObject=b:"undefined"!=typeof a.src?a.src=URL.createObjectURL(b):k.log("Error attaching stream to element.")},g=function(a,b){i>=43?a.srcObject=b.srcObject:a.src=b.src}}else if(navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)){if(k.log("This appears to be Edge"),h="edge",i=k.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2),j=10547,window.RTCIceGatherer){var o=function(){return Math.random().toString(36).substr(2,10)},p=o(),q={};q.splitLines=function(a){return a.trim().split("\n").map(function(a){return a.trim()})},q.splitSections=function(a){var b=a.split("\r\nm=");return b.map(function(a,b){return(b>0?"m="+a:a).trim()+"\r\n"})},q.matchPrefix=function(a,b){return q.splitLines(a).filter(function(a){return 0===a.indexOf(b)})},q.parseCandidate=function(a){var b;b=0===a.indexOf("a=candidate:")?a.substring(12).split(" "):a.substring(10).split(" ");for(var c={foundation:b[0],component:b[1],protocol:b[2].toLowerCase(),priority:parseInt(b[3],10),ip:b[4],port:parseInt(b[5],10),type:b[7]},d=8;d<b.length;d+=2)switch(b[d]){case"raddr":c.relatedAddress=b[d+1];break;case"rport":c.relatedPort=parseInt(b[d+1],10);break;case"tcptype":c.tcpType=b[d+1]}return c},q.writeCandidate=function(a){var b=[];b.push(a.foundation),b.push(a.component),b.push(a.protocol.toUpperCase()),b.push(a.priority),b.push(a.ip),b.push(a.port);var c=a.type;return b.push("typ"),b.push(c),"host"!==c&&a.relatedAddress&&a.relatedPort&&(b.push("raddr"),b.push(a.relatedAddress),b.push("rport"),b.push(a.relatedPort)),a.tcpType&&"tcp"===a.protocol.toLowerCase()&&(b.push("tcptype"),b.push(a.tcpType)),"candidate:"+b.join(" ")},q.parseRtpMap=function(a){var b=a.substr(9).split(" "),c={payloadType:parseInt(b.shift(),10)};return b=b[0].split("/"),c.name=b[0],c.clockRate=parseInt(b[1],10),c.numChannels=3===b.length?parseInt(b[2],10):1,c},q.writeRtpMap=function(a){var b=a.payloadType;return void 0!==a.preferredPayloadType&&(b=a.preferredPayloadType),"a=rtpmap:"+b+" "+a.name+"/"+a.clockRate+(1!==a.numChannels?"/"+a.numChannels:"")+"\r\n"},q.parseFmtp=function(a){for(var b,c={},d=a.substr(a.indexOf(" ")+1).split(";"),e=0;e<d.length;e++)b=d[e].trim().split("="),c[b[0].trim()]=b[1];return c},q.writeFtmp=function(a){var b="",c=a.payloadType;if(void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.parameters&&a.parameters.length){var d=[];Object.keys(a.parameters).forEach(function(b){d.push(b+"="+a.parameters[b])}),b+="a=fmtp:"+c+" "+d.join(";")+"\r\n"}return b},q.parseRtcpFb=function(a){var b=a.substr(a.indexOf(" ")+1).split(" ");return{type:b.shift(),parameter:b.join(" ")}},q.writeRtcpFb=function(a){var b="",c=a.payloadType;return void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(function(a){b+="a=rtcp-fb:"+c+" "+a.type+" "+a.parameter+"\r\n"}),b},q.parseSsrcMedia=function(a){var b=a.indexOf(" "),c={ssrc:a.substr(7,b-7)},d=a.indexOf(":",b);return d>-1?(c.attribute=a.substr(b+1,d-b-1),c.value=a.substr(d+1)):c.attribute=a.substr(b+1),c},q.getDtlsParameters=function(a,b){var c=q.splitLines(a);c=c.concat(q.splitLines(b));var d=c.filter(function(a){return 0===a.indexOf("a=fingerprint:")})[0].substr(14),e={role:"auto",fingerprints:[{algorithm:d.split(" ")[0],value:d.split(" ")[1]}]};return e},q.writeDtlsParameters=function(a,b){var c="a=setup:"+b+"\r\n";return a.fingerprints.forEach(function(a){c+="a=fingerprint:"+a.algorithm+" "+a.value+"\r\n"}),c},q.getIceParameters=function(a,b){var c=q.splitLines(a);c=c.concat(q.splitLines(b));var d={usernameFragment:c.filter(function(a){return 0===a.indexOf("a=ice-ufrag:")})[0].substr(12),password:c.filter(function(a){return 0===a.indexOf("a=ice-pwd:")})[0].substr(10)};return d},q.writeIceParameters=function(a){return"a=ice-ufrag:"+a.usernameFragment+"\r\n"+"a=ice-pwd:"+a.password+"\r\n"},q.parseRtpParameters=function(a){for(var b={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=q.splitLines(a),d=c[0].split(" "),e=3;e<d.length;e++){var f=d[e],g=q.matchPrefix(a,"a=rtpmap:"+f+" ")[0];if(g){var h=q.parseRtpMap(g),i=q.matchPrefix(a,"a=fmtp:"+f+" ");h.parameters=i.length?q.parseFmtp(i[0]):{},h.rtcpFeedback=q.matchPrefix(a,"a=rtcp-fb:"+f+" ").map(q.parseRtcpFb),b.codecs.push(h)}}return b},q.writeRtpDescription=function(a,b){var c="";return c+="m="+a+" ",c+=b.codecs.length>0?"9":"0",c+=" UDP/TLS/RTP/SAVPF ",c+=b.codecs.map(function(a){return void 0!==a.preferredPayloadType?a.preferredPayloadType:a.payloadType}).join(" ")+"\r\n",c+="c=IN IP4 0.0.0.0\r\n",c+="a=rtcp:9 IN IP4 0.0.0.0\r\n",b.codecs.forEach(function(a){c+=q.writeRtpMap(a),c+=q.writeFtmp(a),c+=q.writeRtcpFb(a)}),c+="a=rtcp-mux\r\n"},q.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},q.writeMediaSection=function(a,b,c,d){var e=q.writeRtpDescription(a.kind,b);if(e+=q.writeIceParameters(a.iceGatherer.getLocalParameters()),e+=q.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===c?"actpass":"active"),e+="a=mid:"+a.mid+"\r\n",e+=a.rtpSender&&a.rtpReceiver?"a=sendrecv\r\n":a.rtpSender?"a=sendonly\r\n":a.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",a.rtpSender){var f="msid:"+d.id+" "+a.rtpSender.track.id+"\r\n";e+="a="+f,e+="a=ssrc:"+a.sendSsrc+" "+f}return e+="a=ssrc:"+a.sendSsrc+" cname:"+p+"\r\n"},q.getDirection=function(a,b){for(var c=q.splitLines(a),d=0;d<c.length;d++)switch(c[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[d].substr(2)}return b?q.getDirection(b):"sendrecv"},window.RTCIceCandidate||(window.RTCIceCandidate=function(a){return a}),window.RTCSessionDescription||(window.RTCSessionDescription=function(a){return a}),window.RTCPeerConnection=function(a){var b=this;if(this.onicecandidate=null,this.onaddstream=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return b.localStreams},this.getRemoteStreams=function(){return b.remoteStreams},this.localDescription=new RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},a&&a.iceTransportPolicy)switch(a.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=a.iceTransportPolicy;break;case"none":throw new TypeError('iceTransportPolicy "none" not supported')}a&&a.iceServers&&a.iceServers.forEach(function(a){if(a.urls){var c;c="string"==typeof a.urls?a.urls:a.urls[0],-1!==c.indexOf("transport=udp")&&b.iceServers.push({username:a.username,credential:a.credential,urls:c})}}),this.transceivers=[],this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var a=this;this._localIceCandidatesBuffer.forEach(function(b){null!==a.onicecandidate&&a.onicecandidate(b)}),this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype.addStream=function(a){this.localStreams.push(a.clone()),this._maybeFireNegotiationNeeded()},window.RTCPeerConnection.prototype.removeStream=function(a){var b=this.localStreams.indexOf(a);b>-1&&(this.localStreams.splice(b,1),this._maybeFireNegotiationNeeded())},window.RTCPeerConnection.prototype._getCommonCapabilities=function(a,b){var c={codecs:[],headerExtensions:[],fecMechanisms:[]};return a.codecs.forEach(function(a){for(var d=0;d<b.codecs.length;d++){var e=b.codecs[d];if(a.name.toLowerCase()===e.name.toLowerCase()&&a.clockRate===e.clockRate&&a.numChannels===e.numChannels){c.codecs.push(e);break}}}),a.headerExtensions.forEach(function(a){for(var d=0;d<b.headerExtensions.length;d++){var e=b.headerExtensions[d];if(a.uri===e.uri){c.headerExtensions.push(e);break}}}),c},window.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(a,b){var c=this,d=new RTCIceGatherer(c.iceOptions),e=new RTCIceTransport(d);d.onlocalcandidate=function(f){var g={};g.candidate={sdpMid:a,sdpMLineIndex:b};var h=f.candidate;h&&0!==Object.keys(h).length?(h.component="RTCP"===e.component?2:1,g.candidate.candidate=q.writeCandidate(h)):(void 0===d.state&&(d.state="completed"),g.candidate.candidate="candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates");var i=c.transceivers.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state});null!==c.onicecandidate&&(c.localDescription&&""===c.localDescription.type?(c._localIceCandidatesBuffer.push(g),i&&c._localIceCandidatesBuffer.push({})):(c.onicecandidate(g),i&&c.onicecandidate({})))},e.onicestatechange=function(){c._updateConnectionState()};var f=new RTCDtlsTransport(e);return f.ondtlsstatechange=function(){c._updateConnectionState()},f.onerror=function(){f.state="failed",c._updateConnectionState()},{iceGatherer:d,iceTransport:e,dtlsTransport:f}},window.RTCPeerConnection.prototype._transceive=function(a,b,c){var d=this._getCommonCapabilities(a.localCapabilities,a.remoteCapabilities);b&&a.rtpSender&&(d.encodings=[{ssrc:a.sendSsrc}],d.rtcp={cname:p,ssrc:a.recvSsrc},a.rtpSender.send(d)),c&&a.rtpReceiver&&(d.encodings=[{ssrc:a.recvSsrc}],d.rtcp={cname:a.cname,ssrc:a.sendSsrc},a.rtpReceiver.receive(d))},window.RTCPeerConnection.prototype.setLocalDescription=function(a){var b=this;if("offer"===a.type)this._pendingOffer&&(this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===a.type){var c=q.splitSections(b.remoteDescription.sdp),d=c.shift();c.forEach(function(a,c){var e=b.transceivers[c],f=e.iceGatherer,g=e.iceTransport,h=e.dtlsTransport,i=e.localCapabilities,j=e.remoteCapabilities,k="0"===a.split("\n",1)[0].split(" ",2)[1];if(!k){var l=q.getIceParameters(a,d);g.start(f,l,"controlled");var m=q.getDtlsParameters(a,d);h.start(m);var n=b._getCommonCapabilities(i,j);b._transceive(e,n.codecs.length>0,!1)}})}switch(this.localDescription=a,a.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+a.type+'"')}var e=arguments.length>1&&"function"==typeof arguments[1];if(e){var f=arguments[1];window.setTimeout(function(){f(),b._emitBufferedCandidates()},0)}var g=Promise.resolve();return g.then(function(){e||window.setTimeout(b._emitBufferedCandidates.bind(b),0)}),g},window.RTCPeerConnection.prototype.setRemoteDescription=function(a){var b=this,c=new MediaStream,d=q.splitSections(a.sdp),e=d.shift();switch(d.forEach(function(d,f){var g,h,i,j,k,l,m,n,o,p,r,s=q.splitLines(d),t=s[0].substr(2).split(" "),u=t[0],v="0"===t[1],w=q.getDirection(d,e),x=q.parseRtpParameters(d);v||(p=q.getIceParameters(d,e),r=q.getDtlsParameters(d,e));var y,z=q.matchPrefix(d,"a=mid:")[0].substr(6),A=q.matchPrefix(d,"a=ssrc:").map(function(a){return q.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute})[0];if(A&&(n=parseInt(A.ssrc,10),y=A.value),"offer"===a.type){var B=b._createIceAndDtlsTransports(z,f);if(o=RTCRtpReceiver.getCapabilities(u),m=1001*(2*f+2),l=new RTCRtpReceiver(B.dtlsTransport,u),c.addTrack(l.track),b.localStreams.length>0&&b.localStreams[0].getTracks().length>=f){var C=b.localStreams[0].getTracks()[f];k=new RTCRtpSender(C,B.dtlsTransport)}b.transceivers[f]={iceGatherer:B.iceGatherer,iceTransport:B.iceTransport,dtlsTransport:B.dtlsTransport,localCapabilities:o,remoteCapabilities:x,rtpSender:k,rtpReceiver:l,kind:u,mid:z,cname:y,sendSsrc:m,recvSsrc:n},b._transceive(b.transceivers[f],!1,"sendrecv"===w||"sendonly"===w)}else"answer"!==a.type||v||(g=b.transceivers[f],h=g.iceGatherer,i=g.iceTransport,j=g.dtlsTransport,k=g.rtpSender,l=g.rtpReceiver,m=g.sendSsrc,o=g.localCapabilities,b.transceivers[f].recvSsrc=n,b.transceivers[f].remoteCapabilities=x,b.transceivers[f].cname=y,i.start(h,p,"controlling"),j.start(r),b._transceive(g,"sendrecv"===w||"recvonly"===w,"sendrecv"===w||"sendonly"===w),!l||"sendrecv"!==w&&"sendonly"!==w?delete g.rtpReceiver:c.addTrack(l.track))}),this.remoteDescription=a,a.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+a.type+'"')}return window.setTimeout(function(){null!==b.onaddstream&&c.getTracks().length&&(b.remoteStreams.push(c),window.setTimeout(function(){b.onaddstream({stream:c})},0))},0),arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(a){a.iceTransport&&a.iceTransport.stop(),a.dtlsTransport&&a.dtlsTransport.stop(),a.rtpSender&&a.rtpSender.stop(),a.rtpReceiver&&a.rtpReceiver.stop()}),this._updateSignalingState("closed")},window.RTCPeerConnection.prototype._updateSignalingState=function(a){this.signalingState=a,null!==this.onsignalingstatechange&&this.onsignalingstatechange()},window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){null!==this.onnegotiationneeded&&this.onnegotiationneeded()},window.RTCPeerConnection.prototype._updateConnectionState=function(){var a,b=this,c={"new":0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};this.transceivers.forEach(function(a){c[a.iceTransport.state]++,c[a.dtlsTransport.state]++}),c.connected+=c.completed,a="new",c.failed>0?a="failed":c.connecting>0||c.checking>0?a="connecting":c.disconnected>0?a="disconnected":c["new"]>0?a="new":(c.connecting>0||c.completed>0)&&(a="connected"),a!==b.iceConnectionState&&(b.iceConnectionState=a,null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange())},window.RTCPeerConnection.prototype.createOffer=function(){var a=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");var b;1===arguments.length&&"function"!=typeof arguments[0]?b=arguments[0]:3===arguments.length&&(b=arguments[2]);var c=[],d=0,e=0;if(this.localStreams.length&&(d=this.localStreams[0].getAudioTracks().length,e=this.localStreams[0].getVideoTracks().length),b){if(b.mandatory||b.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==b.offerToReceiveAudio&&(d=b.offerToReceiveAudio),void 0!==b.offerToReceiveVideo&&(e=b.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach(function(a){c.push({kind:a.kind,track:a,wantReceive:"audio"===a.kind?d>0:e>0}),"audio"===a.kind?d--:"video"===a.kind&&e--});d>0||e>0;)d>0&&(c.push({kind:"audio",wantReceive:!0}),d--),e>0&&(c.push({kind:"video",wantReceive:!0}),e--);var f=q.writeSessionBoilerplate(),g=[];c.forEach(function(b,c){var d,e,h=b.track,i=b.kind,j=o(),k=a._createIceAndDtlsTransports(j,c),l=RTCRtpSender.getCapabilities(i),m=1001*(2*c+1);h&&(d=new RTCRtpSender(h,k.dtlsTransport)),b.wantReceive&&(e=new RTCRtpReceiver(k.dtlsTransport,i)),g[c]={iceGatherer:k.iceGatherer,iceTransport:k.iceTransport,dtlsTransport:k.dtlsTransport,localCapabilities:l,remoteCapabilities:null,rtpSender:d,rtpReceiver:e,kind:i,mid:j,sendSsrc:m,recvSsrc:null};var n=g[c];f+=q.writeMediaSection(n,n.localCapabilities,"offer",a.localStreams[0])}),this._pendingOffer=g;var h=new RTCSessionDescription({type:"offer",sdp:f});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,h),Promise.resolve(h)},window.RTCPeerConnection.prototype.createAnswer=function(){var a,b=this;1===arguments.length&&"function"!=typeof arguments[0]?a=arguments[0]:3===arguments.length&&(a=arguments[2]);var c=q.writeSessionBoilerplate();this.transceivers.forEach(function(a){var d=b._getCommonCapabilities(a.localCapabilities,a.remoteCapabilities);c+=q.writeMediaSection(a,d,"answer",b.localStreams[0])});var d=new RTCSessionDescription({type:"answer",sdp:c});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,d),Promise.resolve(d)},window.RTCPeerConnection.prototype.addIceCandidate=function(a){var b=a.sdpMLineIndex;if(a.sdpMid)for(var c=0;c<this.transceivers.length;c++)if(this.transceivers[c].mid===a.sdpMid){b=c;break}var d=this.transceivers[b];if(d){var e=Object.keys(a.candidate).length>0?q.parseCandidate(a.candidate):{};if("tcp"===e.protocol&&0===e.port)return;if("1"!==e.component)return;"endOfCandidates"===e.type&&(e={}),d.iceTransport.addRemoteCandidate(e)}return arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.getStats=function(){var a=[];this.transceivers.forEach(function(b){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(c){b[c]&&a.push(b[c].getStats())})});var b=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1];return new Promise(function(c){var d={};Promise.all(a).then(function(a){a.forEach(function(a){Object.keys(a).forEach(function(b){d[b]=a[b]})}),b&&window.setTimeout(b,0,d),c(d)})})}}}else k.log("Browser does not appear to be WebRTC-capable");else k.log("This does not appear to be a browser"),h="not a browser";"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){var b=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=a),this.addEventListener("addstream",this._ontrackpoly=function(a){"chrome"===h&&a.stream.addEventListener("addtrack",function(c){var d=new Event("track");d.track=c.track,d.receiver={track:c.track},d.streams=[a.stream],b.dispatchEvent(d)}),a.stream.getTracks().forEach(function(b){var c=new Event("track");c.track=b,c.receiver={track:b},c.streams=[a.stream],this.dispatchEvent(c)}.bind(this))}.bind(this))}});var r={};try{Object.defineProperty(r,"version",{set:function(a){i=a}})}catch(s){}c.exports={RTCPeerConnection:window.RTCPeerConnection,RTCIceCandidate:window.RTCIceCandidate,RTCSessionDescription:window.RTCSessionDescription,getUserMedia:e,attachMediaStream:f,reattachMediaStream:g,webrtcDetectedBrowser:h,webrtcDetectedVersion:i,webrtcMinimumVersion:j,webrtcTesting:r,webrtcUtils:k}});
