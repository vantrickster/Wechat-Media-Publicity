define("nowcoder/1.2.582/javascripts/component/popupSub/popupScanUpload",["../../lib/jquery","../../lib/underscore","../../core/base","../../core/component","../../util/util","../../util/cookie","../../util/event","../popup","../layer","../../util/dragdrop","../../util/browser","../../action/common","../../util/ajax","../../core/siteConfig"],function(a,b,c){function d(a){a=a||{};var b=new p(a);return m.wrap(b,{title:"扫码上传",width:480,content:b.html(),render:function(){},listeners:{destroy:function(){b.stopPoll()}}}),b}function e(a){var b=this;b.uploadUrl=k.execTpl((k.isHttps()?"https:":"http:")+"//m"+(k.isInDev()?".d":"")+".nowcoder.com/sync?uid=#{uid}&syncType=#{syncType}&ownerId=#{ownerId}&entityId=#{entityId}",a.data),b.syncResult=[],window.clearTimeout(p.pollTimer),p.superClass.initialize.apply(b,arguments)}function f(){var a=this,b=a.getEl(),c=a.syncResult.length;b.find("span.js-tips").html("(同步数量: "+c+")")[c>0?"show":"hide"]()}function g(a){var b=this,c=b.rawConfig;b.stopPoll(),p.pollTimer=window.setTimeout(function(){o.syncResult({query:c.data,call:function(a){b._destroy||0===(a.data||[]).length||(j.forEach(a.data||[],function(a){a=i.trim(a),a&&(b.syncResult.push(a),c.call&&c.call(a))}),b.showResult(),b.syncResult.length>=r&&window.setTimeout(function(){b.popup.close()},250))}}),!b._destroy&&b.startPoll()},a||q)}function h(){window.clearTimeout(p.pollTimer)}var i=a("../../lib/jquery"),j=a("../../lib/underscore"),k=a("../../core/base"),l=a("../../core/component"),m=a("../popup"),n=a("../../util/util"),o=a("../../action/common"),p=c.exports=k.createClass(),q=5e3,r=1;k.mix(p,l,{xtype:"PopupScanUpload",_template:['<div class="">','<div style="font-size:14px;text-align:center;margin-bottom:10px;">','<div>手机扫描下方二维码进入上传页面<span class="js-tips"></span></div>','<div style="color:#e86142;">上传未完成前请勿关闭本弹窗</div>',"</div>",'<div class="js-image" style="text-align:center;margin:0;padding:0;"></div>',"</div>"].join(""),listeners:[{name:"render",type:"custom",handler:function(){var a=this,b=a.getEl(),c=b.find("div.js-image");c.html('<img src="'+n.rqUrl(a.uploadUrl,150)+'" />'),a.startPoll()}},{name:"destroy",type:"custom",handler:function(){var a=this;a._destroy=!0}}],show:d},{initialize:e,showResult:f,startPoll:g,stopPoll:h})});
